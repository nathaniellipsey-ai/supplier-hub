<!DOCTYPE html>
<!--
ðŸŽ² FIXED SEED VERSION ðŸŽ²
This dashboard now uses a seeded random number generator (seed: 1962 - Walmart's founding year!)
so that everyone who opens this file sees the EXACT SAME supplier data.

âœ… What's shared: All vendor data (names, locations, products, ratings, etc.)
âŒ What's NOT shared: User-specific data (favorites, notes, inbox) - these are stored in browser localStorage

Created with â¤ï¸ by Code Puppy ðŸ¶
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Search Engine - Construction Materials & Products</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&family=Space+Grotesk:wght@500;700&family=Playfair+Display:wght@700;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @keyframes slideInBottom {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideOutBottom {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100px);
                opacity: 0;
            }
        }
        
        :root {
            --walmart-blue: #0071ce;
            --walmart-red: #e02020;
            --walmart-yellow: #ffc220;
            --walmart-dark-blue: #004c91;
            --light-bg: #f8f9fa;
            --border: #e0e0e0;
            --heading-font: 'Bebas Neue', 'Impact', sans-serif;
            --body-font: 'Inter', 'Helvetica Neue', sans-serif;
            --accent-font: 'Space Grotesk', 'Helvetica', sans-serif;
            --serif-font: 'Playfair Display', 'Georgia', serif;
        }

        body {
            font-family: var(--body-font);
            background: #ffffff;
            background-image: 
                linear-gradient(90deg, rgba(0, 113, 206, 0.03) 1px, transparent 1px),
                linear-gradient(rgba(0, 113, 206, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            font-size: 13px;
            line-height: 1.4;
            margin: 0;
            padding: 0;
        }

        .header {
            background: var(--walmart-blue);
            padding: 0;
            position: relative;
            overflow: visible;
            margin-bottom: 0;
        }

        .toolbar {
            background: #f5f5f5;
            border-bottom: 3px solid #ddd;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 99;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 0;
        }

        .toolbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .toolbar-section {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .toolbar-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 8px 16px;
            font-family: var(--accent-font);
            font-weight: 600;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
        }

        .toolbar-btn:hover {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
            transform: translate(-1px, -1px);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
        }

        .toolbar-btn .btn-icon {
            font-size: 1rem;
        }

        .toolbar-info {
            font-family: var(--body-font);
            font-size: 0.9rem;
            color: #666;
        }

        .toolbar-info strong {
            color: var(--walmart-blue);
            font-size: 1.1rem;
        }

        .view-switcher {
            display: flex;
            gap: 5px;
            background: white;
            padding: 3px;
            border: 2px solid #ddd;
        }

        .view-btn {
            background: white;
            border: none;
            padding: 6px 12px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--accent-font);
            letter-spacing: 0.5px;
        }

        .view-btn:hover {
            background: #f0f8ff;
        }

        .view-btn.active {
            background: var(--walmart-blue);
            color: white;
        }

        /* Grid View Styles */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .results-grid .supplier-item {
            display: flex;
            flex-direction: column;
        }

        /* Catalog View Styles */
        .results-catalog {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .supplier-catalog-card {
            background: white;
            border: 3px solid var(--walmart-blue);
            padding: 0;
            transition: all 0.3s;
            position: relative;
        }

        .supplier-catalog-card:hover {
            transform: translateY(-5px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.2);
        }

        .catalog-header {
            background: var(--walmart-blue);
            color: white;
            padding: 20px;
            border-bottom: 3px solid var(--walmart-yellow);
        }

        .catalog-body {
            padding: 20px;
        }

        .catalog-name {
            font-family: var(--heading-font);
            font-size: 1.3rem;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .catalog-category {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .catalog-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .catalog-stat:last-child {
            border-bottom: none;
        }

        .catalog-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px 20px;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 40px;
            position: relative;
            overflow: visible;
        }

        .header-title {
            text-align: center;
            font-family: var(--accent-font);
            font-size: 3rem;
            letter-spacing: 8px;
            color: white;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            white-space: nowrap;
            font-weight: 700;
            font-style: normal;
        }

        .header-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: var(--walmart-yellow);
        }

        .user-menu {
            position: relative;
            z-index: 100000;
        }

        .user-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            font-family: var(--accent-font);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }

        .user-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: var(--walmart-yellow);
        }

        .user-dropdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999999;
            display: none;
        }

        .user-dropdown-overlay.active {
            display: block;
        }

        .user-dropdown {
            position: fixed;
            background: white;
            border: 3px solid var(--walmart-blue);
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            min-width: 220px;
            z-index: 9999999;
            padding: 5px 0;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            font-family: var(--body-font);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .dropdown-item:hover {
            background: var(--walmart-blue);
            color: white;
        }

        .dropdown-divider {
            height: 2px;
            background: #ddd;
            margin: 5px 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }



        .search-container {
            position: relative;
            flex: 1;
            max-width: 300px;
        }

        .search-box {
            width: 100%;
            padding: 6px 35px 6px 30px;
            font-size: 0.85rem;
            font-family: var(--body-font);
            font-weight: 500;
            border: 2px solid #ddd;
            transition: all 0.2s ease;
            background: white;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--walmart-blue);
        }

        .search-box::placeholder {
            color: #999;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1rem;
            animation: searchPulse 2s ease-in-out infinite;
        }

        @keyframes searchPulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
        }

        .clear-search {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 0.9rem;
            display: none;
            padding: 3px;
            line-height: 1;
            transition: all 0.2s;
        }

        .clear-search:hover {
            color: var(--walmart-red);
            transform: translateY(-50%) rotate(90deg) scale(1.1);
        }

        .autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .autocomplete.active { display: block; }

        .autocomplete-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .autocomplete-item:hover {
            background: var(--light-bg);
        }

        .autocomplete-item .icon {
            color: #666;
        }

        .autocomplete-item .text {
            flex: 1;
        }

        .autocomplete-item .category {
            font-size: 0.85rem;
            color: #999;
        }

        .main-content {
            max-width: 1400px;
            margin: 20px auto 20px;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        .filters {
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            padding: 15px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
            overflow-x: hidden;
            position: sticky;
            top: 90px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 113, 206, 0.1);
        }

        .filters::-webkit-scrollbar {
            width: 8px;
        }

        .filters::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .filters::-webkit-scrollbar-thumb {
            background: var(--walmart-blue);
            border-radius: 4px;
        }

        .filters::-webkit-scrollbar-thumb:hover {
            background: var(--walmart-dark-blue);
        }

        .filters-header {
            padding: 20px;
            background: var(--walmart-blue);
            color: white;
            margin: -20px -20px 20px -20px;
            border-bottom: 4px solid var(--walmart-yellow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapse-all-btn {
            background: var(--walmart-yellow);
            color: #000;
            border: none;
            padding: 8px 16px;
            font-family: var(--accent-font);
            font-weight: 700;
            font-size: 0.75rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
        }

        .collapse-all-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.3);
        }

        .collapse-all-btn:active {
            transform: translate(0, 0);
            box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .filter-section {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .filter-section:last-child {
            border-bottom: none;
        }

        .filter-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--walmart-blue);
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }

        .filter-title:hover {
            color: var(--walmart-dark-blue);
        }

        .filter-title .collapse-icon {
            font-size: 0.8rem;
            transition: transform 0.3s;
        }

        .filter-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filter-content.collapsed {
            max-height: 0;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .filter-option input[type="checkbox"] {
            cursor: pointer;
        }

        .filter-option label {
            cursor: pointer;
            flex: 1;
            font-size: 0.85rem;
        }

        .filter-count {
            color: #999;
            font-size: 0.75rem;
        }

        .filter-expand {
            color: var(--walmart-blue);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }

        .filter-expand:hover {
            text-decoration: underline;
        }

        .fixture-subcategory {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .fixture-subcategory-title {
            font-weight: 600;
            color: var(--walmart-blue);
            font-size: 0.85rem;
            margin-bottom: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .fixture-subcategory-title:hover {
            text-decoration: underline;
        }

        .fixture-products {
            margin-left: 12px;
            margin-top: 6px;
        }

        .fixture-products.collapsed {
            display: none;
        }

        .hidden-category {
            display: none;
        }

        .hidden-category.show {
            display: flex;
        }

        .vendor-search {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .vendor-search:focus {
            outline: none;
            border-color: var(--walmart-blue);
        }

        .vendor-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .vendor-list::-webkit-scrollbar {
            width: 6px;
        }

        .vendor-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .vendor-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .walmart-tagline {
            background: var(--walmart-yellow);
            color: #000;
            padding: 8px 20px;
            text-align: center;
            font-family: var(--heading-font);
            font-weight: 900;
            font-size: 0.85rem;
            letter-spacing: 2px;
            text-shadow: none;
            border-bottom: 4px solid var(--walmart-blue);
            position: relative;
            margin: 0;
            border-top: none;
        }



        .results-area {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-box {
            background: var(--walmart-blue);
            color: white;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            position: relative;
            border: 2px solid var(--walmart-dark-blue);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%);
        }

        .stat-box::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 0 10px 10px;
            border-color: transparent transparent var(--walmart-yellow) transparent;
        }

        .stat-box.clickable {
            cursor: pointer;
        }

        .stat-box.clickable:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0, 0, 0, 0.15);
        }

        .stat-box.clickable:active {
            transform: translate(-1px, -1px);
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
        }

        .stat-box.yellow {
            background: var(--walmart-yellow);
            color: #000;
            border-color: #e6a800;
        }

        .stat-box.yellow::after {
            border-color: transparent transparent var(--walmart-blue) transparent;
        }

        .stat-box.red {
            background: var(--walmart-red);
            border-color: #c01818;
        }

        .stat-box.red::after {
            border-color: transparent transparent var(--walmart-blue) transparent;
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 12px;
            filter: drop-shadow(2px 2px 0 rgba(0, 0, 0, 0.3));
        }

        .stat-box .number {
            font-family: var(--heading-font);
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 3px;
            letter-spacing: 1px;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
            line-height: 1;
        }

        .stat-box .label {
            font-family: var(--accent-font);
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            gap: 20px;
            flex-wrap: wrap;
        }

        .results-info {
            font-size: 0.95rem;
            color: #666;
        }

        .sort-options select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .supplier-item {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, var(--walmart-blue), var(--walmart-yellow)) border-box;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .supplier-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 113, 206, 0.1), transparent);
            transition: left 0.5s;
        }

        .supplier-item:hover::before {
            left: 100%;
        }

        .compare-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--walmart-blue);
            flex-shrink: 0;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            filter: grayscale(100%);
            opacity: 0.5;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
            filter: grayscale(0%);
            opacity: 1;
        }

        .favorite-btn.favorited {
            filter: grayscale(0%);
            opacity: 1;
            animation: heartBeat 0.3s ease;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
        }

        .note-btn {
            background: var(--walmart-yellow);
            border: 2px solid #e6a800;
            padding: 6px 12px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .note-btn:hover {
            background: #e6a800;
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
        }

        .note-btn.has-note {
            background: var(--walmart-blue);
            border-color: var(--walmart-dark-blue);
        }

        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .comparison-content {
            background: white;
            width: 100%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            border: 4px solid var(--walmart-blue);
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
        }

        .comparison-header {
            background: var(--walmart-blue);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid var(--walmart-yellow);
        }

        .comparison-table-wrapper {
            overflow-x: auto;
            padding: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--body-font);
        }

        .comparison-table thead {
            background: #f5f5f5;
            border-bottom: 3px solid var(--walmart-blue);
        }

        .comparison-table th {
            padding: 15px;
            text-align: left;
            font-family: var(--heading-font);
            font-size: 1.1rem;
            letter-spacing: 1px;
            border-right: 2px solid #ddd;
        }

        .comparison-table th:first-child {
            background: var(--walmart-blue);
            color: white;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            border-right: 2px solid #ddd;
        }

        .comparison-table td:first-child {
            background: #f9f9f9;
            font-weight: 600;
            position: sticky;
            left: 0;
            z-index: 9;
        }

        .comparison-table tbody tr:hover {
            background: #f0f8ff;
        }

        .score-cell {
            font-weight: 700;
            color: var(--walmart-blue);
            font-size: 1.1rem;
        }

        .supplier-item:hover {
            box-shadow: 0 12px 24px rgba(0, 113, 206, 0.25);
            transform: translateY(-3px);
            border-color: var(--walmart-blue);
        }

        .supplier-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .supplier-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--walmart-blue);
            cursor: pointer;
        }

        .supplier-name:hover {
            text-decoration: underline;
        }

        .supplier-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #666;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .supplier-products {
            margin: 12px 0;
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: #e7f3ff;
            color: var(--walmart-blue);
            padding: 6px 12px;
            border: 2px solid transparent;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-block;
        }

        .tag:hover {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-dark-blue);
            transform: translate(-2px, -2px);
            box-shadow: 3px 3px 0 rgba(0, 113, 206, 0.3);
        }

        .tag:active {
            transform: translate(0, 0);
            box-shadow: 1px 1px 0 rgba(0, 113, 206, 0.3);
        }

        .tag.featured {
            background: var(--walmart-yellow);
            color: #000;
            font-weight: 700;
            border-color: #e6a800;
        }

        .tag.featured:hover {
            background: #e6a800;
            border-color: #cc9600;
        }

        .supplier-certifications {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .cert-badge {
            background: #d4edda;
            color: #155724;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .page-btn {
            padding: 8px 15px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
        }

        .page-btn.active {
            background: var(--walmart-blue);
            color: white;
            border-color: var(--walmart-blue);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-score {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, var(--walmart-blue) 0%, var(--walmart-dark-blue) 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .walmart-verified {
            background: var(--walmart-red);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--walmart-blue) 0%, var(--walmart-dark-blue) 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 12px 12px 0 0;
            position: relative;
        }

        .modal-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .modal-header .subtitle {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-close:focus {
            outline: 3px solid var(--walmart-yellow);
            outline-offset: 2px;
        }

        .modal-body {
            padding: 30px;
        }

        /* ðŸ†• Category Card Styles */
        .category-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 12px;
            min-height: 140px;
        }

        .category-card:hover {
            border-color: var(--walmart-blue);
            background: linear-gradient(135deg, rgba(0, 113, 206, 0.05), rgba(0, 113, 206, 0.1));
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 113, 206, 0.15);
        }

        .category-card:active {
            transform: translateY(-2px);
        }

        .category-icon {
            font-size: 2.5rem;
            line-height: 1;
        }

        .category-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-dark);
            line-height: 1.3;
        }

        .category-count {
            font-size: 0.8rem;
            color: var(--walmart-blue);
            font-weight: 600;
            background: rgba(0, 113, 206, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            width: 100%;
        }

        .modal-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .modal-section h3 {
            color: var(--walmart-blue);
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .info-value {
            font-size: 1rem;
            color: #333;
        }

        .contact-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .contact-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .contact-btn.primary {
            background: var(--walmart-blue);
            color: white;
        }

        .contact-btn.primary:hover {
            background: var(--walmart-dark-blue);
            transform: translateY(-2px);
        }

        .contact-btn.secondary {
            background: white;
            color: var(--walmart-blue);
            border: 2px solid var(--walmart-blue);
        }

        .contact-btn.secondary:hover {
            background: var(--walmart-blue);
            color: white;
        }

        .description-text {
            line-height: 1.6;
            color: #555;
        }

        .stat-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--walmart-blue);
        }

        .stat-card .label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .filters {
                position: static;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="walmart-tagline">
        SAVE MONEY. LIVE BETTER. FIND BETTER SUPPLIERS.
    </div>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div style="background: var(--walmart-yellow); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border: 3px solid var(--walmart-blue); font-size: 1.5rem; font-weight: 900;">W</div>
                <div>
                    <div style="font-family: var(--heading-font); font-size: 1.8rem; font-weight: 900; letter-spacing: 1px; line-height: 0.9;">WALMART</div>
                    <div style="font-family: var(--accent-font); font-size: 0.65rem; font-weight: 600; letter-spacing: 3px; margin-top: 2px;">VENDOR DISCOVERY</div>
                </div>
            </div>
            <div class="header-title">SUPPLIER HUB</div>
            <div class="user-menu" id="userMenu" style="justify-self: end;">
                <button class="user-btn" onclick="toggleUserDropdown(event)" id="userMenuBtn">
                    <span id="userName">Guest</span>
                    <span style="font-size: 0.7rem;">â–¼</span>
                </button>
            </div>
        </div>
    </header>

    <nav class="toolbar">
        <div class="toolbar-content">
            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="window.location.reload()">
                    <span>HOME</span>
                </button>
                <button class="toolbar-btn" onclick="window.location.href='help.html'">
                    <span>ðŸ“– HELP</span>
                </button>
                <button class="toolbar-btn" onclick="exportResults()">
                    <span>EXPORT</span>
                </button>
                <button class="toolbar-btn" onclick="printResults()">
                    <span>PRINT</span>
                </button>
            </div>
            <div class="toolbar-section">
                <button class="toolbar-btn" onclick="openAddSupplierModal()" title="Add a new supplier">
                    <span>âž• ADD</span>
                </button>
                <button class="toolbar-btn" onclick="openImportModal()" title="Import suppliers from CSV">
                    <span>ðŸ“¥ IMPORT</span>
                </button>
                <button class="toolbar-btn" onclick="clearAllFilters()">
                    <span class="btn-icon">RESET</span>
                </button>
                <button class="toolbar-btn" onclick="toggleCompareMode()">
                    <span id="compareBtnText">COMPARE (0)</span>
                </button>
            </div>
            <div class="toolbar-section">
                <span class="toolbar-info">
                    <strong id="toolbarResultCount">0</strong> suppliers found
                </span>
                <span class="toolbar-info" id="spStatus" style="margin-left: 15px; font-size: 0.75rem; opacity: 0.8;">
                    ðŸ”„ Connecting...
                </span>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <aside class="filters">
            <div class="filters-header">
                <h3 style="font-family: var(--heading-font); font-size: 1.5rem; letter-spacing: 2px; margin: 0;">FILTERS</h3>
                <button id="collapseAllBtn" class="collapse-all-btn" onclick="toggleAllFilters()">
                    <span id="collapseAllText">COLLAPSE ALL</span>
                </button>
            </div>
            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('vendorSection')">
                    <span>Vendors</span>
                    <span class="collapse-icon" id="vendorSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="vendorSection">
                    <input type="text" class="vendor-search" id="vendorSearch" placeholder="Search vendors..." aria-label="Search vendors">
                    <div class="vendor-list" id="vendorFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('categorySection')">
                    <span>Material Category</span>
                    <span class="collapse-icon" id="categorySection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="categorySection">
                    <div id="categoryFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('productSection')">
                    <span>Product Type</span>
                    <span class="collapse-icon" id="productSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="productSection">
                    <div id="productTypeFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('fixtureSection')">
                    <span>Fixtures & Hardware</span>
                    <span class="collapse-icon" id="fixtureSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="fixtureSection">
                    <div id="fixtureFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('regionSection')">
                    <span>Region</span>
                    <span class="collapse-icon" id="regionSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="regionSection">
                    <div id="regionFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('certSection')">
                    <span>Certifications</span>
                    <span class="collapse-icon" id="certSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="certSection">
                    <div id="certFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('sizeSection')">
                    <span>Company Size</span>
                    <span class="collapse-icon" id="sizeSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="sizeSection">
                    <div id="sizeFilters"></div>
                </div>
            </div>

            <div class="filter-section">
                <div class="filter-title" onclick="toggleFilterSection('priceSection')">
                    <span>Price Range</span>
                    <span class="collapse-icon" id="priceSection-icon">â–²</span>
                </div>
                <div class="filter-content collapsed" id="priceSection">
                    <div id="priceFilters"></div>
                </div>
            </div>
        </aside>

        <main class="results-area" role="main">
                <div class="stats-dashboard">
                    <div class="stat-box clickable" onclick="filterByStat('all')" title="Click to reset and show all suppliers">
                        <div class="number" id="totalSuppliersCount">0</div>
                        <div class="label">Total Suppliers</div>
                    </div>
                    <div class="stat-box yellow clickable" onclick="showCategoryModal()" title="Click to browse categories">
                        <div class="number" id="categoriesCount">0</div>
                        <div class="label">Categories</div>
                    </div>
                    <div class="stat-box red clickable" onclick="filterByStat('products')" title="Click to sort vendors by number of products">
                        <div class="number" id="productsCount">0</div>
                        <div class="label">Products Available</div>
                    </div>
                    <div class="stat-box clickable" onclick="filterByStat('verified')" title="Click to show only Walmart Verified suppliers">
                        <div class="number" id="verifiedCount">0</div>
                        <div class="label">Walmart Verified</div>
                    </div>
                </div>

                <div class="results-header">
                <div class="results-info">
                    <span id="resultsCount">0</span> suppliers found
                </div>
                <div class="search-container">
                    <span class="search-icon">âŒ•</span>
                    <input 
                        type="text" 
                        class="search-box" 
                        id="searchInput"
                        placeholder="Search suppliers, products, brands, SKUs..."
                        aria-label="Search suppliers and products"
                        autocomplete="off"
                    >
                    <button class="clear-search" id="clearSearch" aria-label="Clear search">âœ•</button>
                    <div class="autocomplete" id="autocomplete"></div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="view-switcher">
                        <button class="view-btn active" id="viewList" onclick="switchView('list')" title="List view">
                            LIST
                        </button>
                        <button class="view-btn" id="viewGrid" onclick="switchView('grid')" title="Grid view">
                            GRID
                        </button>
                        <button class="view-btn" id="viewCatalog" onclick="switchView('catalog')" title="Catalog view">
                            CATALOG
                        </button>
                    </div>
                    <div class="sort-options">
                        <select id="sortSelect" aria-label="Sort results">
                            <option value="relevance">Most Relevant</option>
                            <option value="score-high">AI Score: High to Low</option>
                            <option value="score-low">AI Score: Low to High</option>
                            <option value="name-asc">Name: A to Z</option>
                            <option value="name-desc">Name: Z to A</option>
                            <option value="rating">Customer Rating</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="resultsContainer"></div>

            <div class="pagination" id="pagination"></div>
        </main>
    </div>

    <div class="modal" id="supplierModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <div class="subtitle" id="modalSubtitle"></div>
                <button class="modal-close" id="modalClose" aria-label="Close modal">âœ•</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- ðŸ†• Category Picker Modal -->
    <div class="modal" id="categoryModal" role="dialog" aria-modal="true" aria-labelledby="categoryModalTitle">
        <div class="modal-content" style="max-width: 900px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="categoryModalTitle">ðŸ“š Select a Category</h2>
                <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">Click on any category to see suppliers</p>
                <button class="modal-close" id="categoryModalClose" aria-label="Close modal">âœ•</button>
            </div>
            <div class="modal-body" id="categoryModalBody" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 20px;">
                <!-- Categories will be populated here -->
            </div>
        </div>
    </div>

    <script>

// API URL - point to the Python API server
const API_URL = 'http://localhost:8000';
let USE_API = false; // Set to true to use API instead of local generation

// Function to load suppliers from API
async function loadSuppliersFromAPI(skip = 0, limit = 5000) {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/suppliers?skip=${skip}&limit=${limit}`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.suppliers || [];
    } catch (error) {
        console.warn('API load failed, using local generation:', error);
        USE_API = false;
        return null;
    }
}

// Function to load dashboard stats from API
async function loadStatsFromAPI() {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/stats`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data;
    } catch (error) {
        console.warn('API stats load failed:', error);
        return null;
    }
}

// Function to search suppliers from API
async function searchSuppliersFromAPI(query) {
    try {
        const response = await fetch(`${API_URL}/api/dashboard/suppliers/search?q=${encodeURIComponent(query)}`);
        if (!response.ok) throw new Error('API Error');
        const data = await response.json();
        return data.results || [];
    } catch (error) {
        console.warn('API search failed:', error);
        return null;
    }
}

        // Comprehensive product catalog
        const productCategories = {
            'Concrete & Cement': ['Ready-Mix Concrete', 'Precast Concrete', 'Concrete Blocks', 'Portland Cement', 'Concrete Admixtures', 'Fiber-Reinforced Concrete', 'Self-Leveling Concrete', 'Decorative Concrete'],
            'Steel & Metal': ['Structural Steel', 'Rebar', 'Steel Beams', 'Metal Studs', 'Sheet Metal', 'Galvanized Steel', 'Aluminum', 'Copper Piping', 'Steel Decking'],
            'Lumber & Wood': ['Dimensional Lumber', 'Plywood', 'OSB Panels', 'Engineered Wood', 'Treated Lumber', 'Hardwood Flooring', 'Laminated Beams', 'Wood Trusses'],
            'Roofing Materials': ['Asphalt Shingles', 'Metal Roofing', 'TPO Membrane', 'EPDM Roofing', 'Tile Roofing', 'Underlayment', 'Flashing', 'Roof Coatings'],
            'Insulation': ['Fiberglass Batts', 'Spray Foam', 'Rigid Foam Board', 'Mineral Wool', 'Cellulose Insulation', 'Reflective Insulation', 'Acoustic Insulation'],
            'Drywall & Gypsum': ['Standard Drywall', 'Moisture-Resistant Drywall', 'Fire-Rated Drywall', 'Ceiling Tiles', 'Joint Compound', 'Drywall Tape'],
            'Electrical': ['Wire & Cable', 'Conduit', 'Junction Boxes', 'Breaker Panels', 'LED Fixtures', 'Switches & Outlets', 'Cable Trays', 'Emergency Lighting'],
            'Plumbing': ['PVC Pipe', 'Copper Pipe', 'PEX Tubing', 'Valves & Fittings', 'Water Heaters', 'Fixtures', 'Drain Systems', 'Backflow Preventers'],
            'HVAC': ['Air Handling Units', 'Ductwork', 'Thermostats', 'Refrigerant', 'Air Filters', 'Ventilation Fans', 'Heat Pumps', 'Boilers'],
            'Flooring': ['Vinyl Flooring', 'Ceramic Tile', 'Carpet', 'Hardwood', 'Laminate', 'Epoxy Coatings', 'Polished Concrete', 'Rubber Flooring'],
            'Windows & Doors': ['Vinyl Windows', 'Aluminum Windows', 'Steel Doors', 'Wood Doors', 'Fiberglass Doors', 'Sliding Glass Doors', 'French Doors', 'Garage Doors', 'Storm Doors'],
            'Door Hardware & Fixtures': ['Door Handles', 'Door Knobs', 'Deadbolts', 'Door Closers', 'Hinges', 'Door Stops', 'Panic Hardware', 'Access Control Systems', 'Automatic Door Openers'],
            'Lighting Fixtures': ['LED Downlights', 'Chandeliers', 'Pendant Lights', 'Track Lighting', 'Wall Sconces', 'Outdoor Lighting', 'Emergency Exit Lights', 'Motion Sensor Lights'],
            'Plumbing Fixtures': ['Toilets', 'Sinks', 'Faucets', 'Shower Heads', 'Bathtubs', 'Urinals', 'Drinking Fountains', 'Floor Drains', 'Grab Bars'],
            'Kitchen & Bath Fixtures': ['Kitchen Sinks', 'Kitchen Faucets', 'Garbage Disposals', 'Range Hoods', 'Bathroom Vanities', 'Medicine Cabinets', 'Towel Bars', 'Soap Dispensers'],
            'Safety & Security Fixtures': ['Smoke Detectors', 'Carbon Monoxide Detectors', 'Fire Extinguishers', 'Fire Alarms', 'Security Cameras', 'Motion Sensors', 'Emergency Lighting', 'Exit Signs', 'Safety Railings', 'Bollards', 'Security Gates', 'Card Readers', 'Keypad Entry Systems'],
            'Vinyl Products': ['Vinyl Siding', 'Vinyl Trim', 'Vinyl Soffit', 'Vinyl Fencing', 'Vinyl Flooring', 'Vinyl Window Frames', 'Vinyl Railings'],
            'HVAC Fixtures': ['Air Vents', 'Registers', 'Grilles', 'Diffusers', 'Return Air Grilles', 'HVAC Dampers', 'Ceiling Fans', 'Exhaust Fans'],
            'Temporary Construction Equipment': ['Temporary Walls', 'Temporary Partitions', 'Construction Fencing', 'Crowd Barriers', 'Jersey Barriers', 'Safety Barricades', 'Temporary Gates', 'Dust Barriers', 'Wind Screens'],
            'Personal Protective Equipment': ['Hard Hats', 'Safety Glasses', 'Face Shields', 'Respirators', 'Dust Masks', 'Work Gloves', 'Safety Vests', 'Fall Protection Harnesses', 'Ear Protection', 'Steel Toe Boots', 'Knee Pads', 'Hi-Vis Clothing'],
            'Cart & Transport Equipment': ['Shopping Carts', 'Material Carts', 'Platform Carts', 'Hand Trucks', 'Dollies', 'Pallet Jacks', 'Cart Wheels', 'Cart Parts', 'Utility Carts', 'Laundry Carts', 'Waste Collection Carts'],
            'Scaffolding & Ladders': ['Frame Scaffolding', 'Rolling Scaffolding', 'Extension Ladders', 'Step Ladders', 'Platform Ladders', 'Scaffold Planks', 'Scaffold Accessories', 'Ladder Safety Cages'],
            'Signage & Wayfinding': ['ADA Signs', 'Exit Signs', 'Directional Signs', 'Parking Signs', 'Safety Signs', 'Floor Graphics', 'Digital Displays', 'Post & Panel Signs', 'Monument Signs'],
            'Material Handling Equipment': ['Forklifts', 'Pallet Racks', 'Conveyor Systems', 'Hoists', 'Cranes', 'Lifting Slings', 'Chain Hoists', 'Dock Levelers', 'Wheel Chocks'],
            'Concrete Forms & Accessories': ['Wall Forms', 'Column Forms', 'Slab Forms', 'Form Ties', 'Form Release Agents', 'Snap Ties', 'Walers', 'Concrete Screeds'],
            'Site Furnishings': ['Benches', 'Picnic Tables', 'Bike Racks', 'Trash Receptacles', 'Ash Urns', 'Planters', 'Bollards', 'Flagpoles'],
            'Janitorial & Maintenance': ['Floor Cleaners', 'Mops & Buckets', 'Cleaning Chemicals', 'Trash Bags', 'Paper Products', 'Sanitizers', 'Floor Machines', 'Pressure Washers'],
            'Landscape & Site Work': ['Mulch', 'Topsoil', 'Gravel', 'Landscape Fabric', 'Drainage Pipes', 'Irrigation Systems', 'Retaining Walls', 'Geotextiles'],
            'Acoustic & Soundproofing': ['Acoustic Panels', 'Soundproofing Insulation', 'Acoustic Ceiling Tiles', 'Mass Loaded Vinyl', 'Sound Barriers', 'Acoustic Doors', 'Acoustic Sealants'],
            'Fire Protection Systems': ['Sprinkler Heads', 'Fire Hoses', 'Fire Pumps', 'Fire Hydrants', 'Standpipe Systems', 'Fire Dampers', 'Fire Rated Doors', 'Fire Suppression Systems'],
            'Loading Dock Equipment': ['Dock Levelers', 'Dock Bumpers', 'Dock Seals', 'Dock Shelters', 'Dock Lights', 'Wheel Guides', 'Vehicle Restraints', 'Dock Plates'],
            'Masonry': ['Brick', 'Concrete Block', 'Mortar', 'Stone Veneer', 'Retaining Wall Systems', 'Pavers', 'Grout'],
            'Paint & Coatings': ['Interior Paint', 'Exterior Paint', 'Primers', 'Epoxy Coatings', 'Stains & Sealers', 'Waterproofing', 'Fire-Retardant Coatings', 'Traffic Marking Paint'],
            'Fasteners & Hardware': ['Screws', 'Nails', 'Bolts & Anchors', 'Brackets', 'Hinges', 'Clips', 'Straps', 'Washers', 'Nuts'],
            'Shelving & Storage': ['Wire Shelving', 'Heavy Duty Shelving', 'Garage Storage', 'Closet Organizers', 'Tool Storage', 'Cabinets', 'Lockers', 'Storage Bins'],
            'Tools & Equipment': ['Power Tools', 'Hand Tools', 'Measuring Tools', 'Cutting Tools', 'Tool Belts', 'Tool Boxes', 'Generators', 'Air Compressors'],
            'Adhesives & Sealants': ['Construction Adhesive', 'Silicone Sealant', 'Caulk', 'Epoxy', 'Wood Glue', 'Concrete Bonding Agents', 'Spray Adhesives', 'Tapes'],
            'Retail Fixtures & Displays': ['Gondola Shelving', 'End Caps', 'Display Tables', 'Slatwall Panels', 'Grid Walls', 'Mannequins', 'Clothing Racks', 'Pegboard Displays', 'Glass Display Cases'],
            'Checkout & POS Equipment': ['Checkout Counters', 'Conveyor Belts', 'Bagging Stations', 'Card Readers', 'Cash Drawers', 'Receipt Printers', 'Self-Checkout Kiosks', 'Scanner Scales'],
            'Commercial Refrigeration': ['Walk-In Coolers', 'Walk-In Freezers', 'Refrigerated Display Cases', 'Reach-In Refrigerators', 'Ice Machines', 'Refrigeration Condensers', 'Evaporator Coils', 'Glass Door Merchandisers'],
            'Commercial Kitchen Equipment': ['Commercial Ovens', 'Fryers', 'Griddles', 'Deli Slicers', 'Food Warmers', 'Prep Tables', 'Commercial Sinks', 'Bakery Ovens', 'Mixers'],
            'Parking Lot & Site Equipment': ['Parking Lot Striping', 'Light Poles', 'Cart Corrals', 'Asphalt Sealant', 'Parking Bollards', 'Speed Bumps', 'Wheel Stops', 'Parking Signs', 'Pavement Markings'],
            'Commercial Flooring Systems': ['Polished Concrete', 'VCT Tile', 'Anti-Fatigue Mats', 'Commercial Carpet Tile', 'Epoxy Floor Coatings', 'Floor Leveling Compound', 'Transition Strips', 'Walk-Off Mats'],
            'Ceiling Systems': ['Drop Ceiling Grid', 'Acoustic Ceiling Tiles', 'Metal Ceiling Panels', 'Suspended Ceiling Hangers', 'Ceiling Insulation', 'Ceiling Access Panels'],
            'Commercial Overhead Doors': ['Sectional Overhead Doors', 'Rolling Steel Doors', 'High-Speed Doors', 'Dock Doors', 'Fire Doors', 'Door Operators', 'Loading Dock Seals'],
            'Commercial Lighting Systems': ['High Bay LED Fixtures', 'Retail Track Lighting', 'Parking Lot Lights', 'Emergency Backup Lighting', 'Lighting Controls', 'Occupancy Sensors', 'Warehouse Lighting'],
            'Loss Prevention Equipment': ['EAS Security Tags', 'Security Pedestals', 'CCTV Cameras', 'DVR Systems', 'Security Mirrors', 'Locking Showcases', 'Anti-Theft Devices'],
            'Building Automation & Controls': ['HVAC Controls', 'Energy Management Systems', 'Building Management Software', 'Programmable Thermostats', 'Automated Lighting Controls', 'Access Control Systems'],
            'Emergency Power Systems': ['Backup Generators', 'UPS Systems', 'Transfer Switches', 'Fuel Tanks', 'Battery Backup Systems', 'Emergency Lighting Inverters'],
            'Commercial Plumbing Systems': ['Grease Traps', 'Backflow Preventers', 'Commercial Water Heaters', 'Floor Drains', 'Mop Sinks', 'Pre-Rinse Spray Valves', 'Hydrants'],
            'Commercial Roofing Systems': ['TPO Roofing Membrane', 'EPDM Rubber Roofing', 'Metal Roof Panels', 'Roof Insulation', 'Roof Drains', 'Flashing Systems', 'Parapet Caps'],
            'Department-Specific Fixtures': ['Pharmacy Counters', 'Bakery Display Cases', 'Deli Cases', 'Meat Cases', 'Produce Racks', 'Garden Center Shelving', 'Apparel Fixtures', 'Electronics Security Cases'],
            'Auto Service Equipment': ['Tire Changers', 'Wheel Balancers', 'Automotive Lifts', 'Oil Drain Systems', 'Air Compressors', 'Battery Chargers', 'Diagnostic Equipment'],
            'Waste Management Systems': ['Compactors', 'Balers', 'Dumpsters', 'Recycling Bins', 'Waste Containers', 'Cardboard Balers', 'Grease Containers'],
            'Wall Systems & Partitions': ['Metal Stud Framing', 'Demountable Partitions', 'Bathroom Partitions', 'Modular Walls', 'FRP Panels', 'Wall Protection', 'Corner Guards']
        };

        const regions = ['Northeast', 'Southeast', 'Midwest', 'Southwest', 'West', 'National'];
        const certifications = ['ISO 9001', 'LEED', 'MBE', 'WBE', 'OSHA Certified', 'Energy Star Partner'];
        const companySizes = ['Small (1-50)', 'Medium (51-500)', 'Large (500+)'];
        const priceRanges = ['Budget ($)', 'Standard ($$)', 'Premium ($$$)', 'Enterprise ($$$$)'];

        // ðŸŽ² Seeded Random Number Generator (Mulberry32)
        // Using seed 1962 (Walmart founded in 1962!) so everyone sees the same "random" data
        function createSeededRandom(seed = 1962) {
            return function() {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        
        const seededRandom = createSeededRandom(1962); // Fixed seed for consistent data!

        // ==========================================
        // ðŸ”§ GLOBAL VARIABLES
        // ==========================================
        
        let allSuppliers = [];  // All suppliers from server
        let filteredSuppliers = [];  // Filtered suppliers based on search/filter
        let currentUser = null;  // Current logged-in user email
        let userData = null;  // Current user's data (favorites, notes, etc.)
        let useSharePoint = false;  // Whether SharePoint is available
        let currentPage = 1;  // Current pagination page
        let itemsPerPage = 20;  // Items per page
        let compareList = [];  // List of suppliers being compared
        let currentView = 'list';  // Current view type (list, grid, catalog)

        // ==========================================
        // ðŸ’¾ STORAGE SERVICE (localStorage only)
        // ==========================================
        
        const storage = {
            // Get user data from localStorage
            getUser: async function(userEmail) {
                try {
                    const userStr = localStorage.getItem('supplierPortalUser');
                    if (!userStr) return null;
                    
                    const user = JSON.parse(userStr);
                    if (user.email === userEmail) {
                        return user;
                    }
                    return null;
                } catch (error) {
                    console.error('Error getting user:', error);
                    return null;
                }
            },
            
            // Save user data to localStorage
            saveUser: async function(userEmail, userData) {
                try {
                    const user = {
                        ...userData,
                        email: userEmail,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('supplierPortalUser', JSON.stringify(user));
                    console.log('ðŸ’¾ Saved user:', userEmail);
                    return true;
                } catch (error) {
                    console.error('Error saving user:', error);
                    return false;
                }
            },
            
            // Add favorite
            addFavorite: async function(userEmail, supplierId) {
                try {
                    if (!userData.favorites) userData.favorites = [];
                    if (!userData.favorites.includes(supplierId)) {
                        userData.favorites.push(supplierId);
                        await this.saveUser(userEmail, userData);
                    }
                    return true;
                } catch (error) {
                    console.error('Error adding favorite:', error);
                    return false;
                }
            },
            
            // Remove favorite
            removeFavorite: async function(userEmail, supplierId) {
                try {
                    if (userData.favorites) {
                        userData.favorites = userData.favorites.filter(id => id !== supplierId);
                        await this.saveUser(userEmail, userData);
                    }
                    return true;
                } catch (error) {
                    console.error('Error removing favorite:', error);
                    return false;
                }
            },
            
            // Save note
            saveNote: async function(userEmail, supplierId, noteText) {
                try {
                    if (!userData.notes) userData.notes = {};
                    if (noteText.trim()) {
                        userData.notes[supplierId] = noteText;
                    } else {
                        delete userData.notes[supplierId];
                    }
                    await this.saveUser(userEmail, userData);
                    return true;
                } catch (error) {
                    console.error('Error saving note:', error);
                    return false;
                }
            }
        };

        // ==========================================
        // ðŸ”— API CONFIGURATION
        // ==========================================
        
        // Auto-detect API base URL
        const API_BASE = window.location.origin; // Use current domain

        // ==========================================
        // ðŸ—„ï¸ SHAREPOINT BACKEND INTEGRATION
        // ==========================================
        
        const SHAREPOINT_CONFIG = {
            siteUrl: 'https://walmart.sharepoint.com/sites/SupplierPortal',
            lists: {
                userProfiles: 'UserProfiles',
                favorites: 'SupplierFavorites',
                notes: 'SupplierNotes',
                inbox: 'SupplierInbox'
            },
            enabled: false, // âš ï¸ SET TO TRUE after creating SharePoint lists! (See SHAREPOINT-SETUP-GUIDE.html)
            useLocalStorageFallback: true // Use localStorage if SharePoint fails
        };

        /* 
        ðŸ“‹ SHAREPOINT SETUP INSTRUCTIONS:
        
        Create these 4 lists in your SharePoint site (https://walmart.sharepoint.com/sites/SupplierPortal):
        
        1. UserProfiles
           - Title (Single line of text) - User email
           - FullName (Single line of text)
           - Department (Single line of text)
           - LastLogin (Date and Time)
        
        2. SupplierFavorites
           - Title (Single line of text) - User email
           - SupplierId (Number)
           - DateAdded (Date and Time)
        
        3. SupplierNotes
           - Title (Single line of text) - User email
           - SupplierId (Number)
           - NoteText (Multiple lines of text)
           - DateCreated (Date and Time)
           - DateModified (Date and Time)
        
        4. SupplierInbox
           - Title (Single line of text) - User email
           - MessageId (Number)
           - Vendor (Single line of text)
           - Subject (Single line of text)
           - Message (Multiple lines of text)
           - DateReceived (Date and Time)
           - IsRead (Yes/No)
           - IsStarred (Yes/No)
        */

        // SharePoint Service Class
        class SharePointService {
            constructor(config) {
                this.config = config;
                this.digestValue = null;
                this.currentUserEmail = null;
            }

            async init() {
                if (!this.config.enabled) return false;
                
                try {
                    // Get current user from Microsoft Graph or SharePoint
                    await this.getCurrentUser();
                    return true;
                } catch (error) {
                    console.warn('SharePoint init failed, using localStorage fallback:', error);
                    return false;
                }
            }

            async getCurrentUser() {
                try {
                    const response = await fetch(`${this.config.siteUrl}/_api/web/currentuser`, {
                        headers: {
                            'Accept': 'application/json;odata=verbose'
                        },
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.currentUserEmail = data.d.Email;
                        return this.currentUserEmail;
                    }
                } catch (error) {
                    console.warn('Could not get current user from SharePoint:', error);
                }
                return null;
            }

            async getRequestDigest() {
                if (this.digestValue) return this.digestValue;
                
                try {
                    const response = await fetch(`${this.config.siteUrl}/_api/contextinfo`, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json;odata=verbose'
                        },
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.digestValue = data.d.GetContextWebInformation.FormDigestValue;
                        return this.digestValue;
                    }
                } catch (error) {
                    console.warn('Could not get request digest:', error);
                }
                return null;
            }

            async getUserProfile(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.userProfiles}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.d.results.length > 0) {
                            return data.d.results[0];
                        }
                    }
                } catch (error) {
                    console.warn('Error getting user profile:', error);
                }
                return null;
            }

            async createUserProfile(email, fullName, department) {
                const digest = await this.getRequestDigest();
                if (!digest) return null;
                
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.userProfiles}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json;odata=verbose',
                                'Content-Type': 'application/json;odata=verbose',
                                'X-RequestDigest': digest
                            },
                            credentials: 'include',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.UserProfilesListItem' },
                                Title: email,
                                FullName: fullName,
                                Department: department,
                                LastLogin: new Date().toISOString()
                            })
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.d;
                    }
                } catch (error) {
                    console.warn('Error creating user profile:', error);
                }
                return null;
            }

            async getFavorites(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.d.results.map(item => item.SupplierId);
                    }
                } catch (error) {
                    console.warn('Error getting favorites:', error);
                }
                return [];
            }

            async addFavorite(email, supplierId) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items`,
                        {
                            method: 'POST',
                            headers: {
                                'Accept': 'application/json;odata=verbose',
                                'Content-Type': 'application/json;odata=verbose',
                                'X-RequestDigest': digest
                            },
                            credentials: 'include',
                            body: JSON.stringify({
                                __metadata: { type: 'SP.Data.SupplierFavoritesListItem' },
                                Title: email,
                                SupplierId: supplierId,
                                DateAdded: new Date().toISOString()
                            })
                        }
                    );
                    
                    return response.ok;
                } catch (error) {
                    console.warn('Error adding favorite:', error);
                }
                return false;
            }

            async removeFavorite(email, supplierId) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    // First, get the item ID
                    const getResponse = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items?$filter=Title eq '${email}' and SupplierId eq ${supplierId}`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        if (data.d.results.length > 0) {
                            const itemId = data.d.results[0].Id;
                            
                            // Delete the item
                            const deleteResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.favorites}')/items(${itemId})`,
                                {
                                    method: 'DELETE',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest,
                                        'IF-MATCH': '*'
                                    },
                                    credentials: 'include'
                                }
                            );
                            
                            return deleteResponse.ok;
                        }
                    }
                } catch (error) {
                    console.warn('Error removing favorite:', error);
                }
                return false;
            }

            async getNotes(email) {
                try {
                    const response = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items?$filter=Title eq '${email}'`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (response.ok) {
                        const data = await response.json();
                        const notes = {};
                        data.d.results.forEach(item => {
                            notes[item.SupplierId] = item.NoteText;
                        });
                        return notes;
                    }
                } catch (error) {
                    console.warn('Error getting notes:', error);
                }
                return {};
            }

            async saveNote(email, supplierId, noteText) {
                const digest = await this.getRequestDigest();
                if (!digest) return false;
                
                try {
                    // Check if note exists
                    const getResponse = await fetch(
                        `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items?$filter=Title eq '${email}' and SupplierId eq ${supplierId}`,
                        {
                            headers: {
                                'Accept': 'application/json;odata=verbose'
                            },
                            credentials: 'include'
                        }
                    );
                    
                    if (getResponse.ok) {
                        const data = await getResponse.json();
                        
                        if (data.d.results.length > 0) {
                            // Update existing note
                            const itemId = data.d.results[0].Id;
                            const updateResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items(${itemId})`,
                                {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'Content-Type': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest,
                                        'IF-MATCH': '*',
                                        'X-HTTP-Method': 'MERGE'
                                    },
                                    credentials: 'include',
                                    body: JSON.stringify({
                                        __metadata: { type: 'SP.Data.SupplierNotesListItem' },
                                        NoteText: noteText,
                                        DateModified: new Date().toISOString()
                                    })
                                }
                            );
                            return updateResponse.ok;
                        } else {
                            // Create new note
                            const createResponse = await fetch(
                                `${this.config.siteUrl}/_api/web/lists/getbytitle('${this.config.lists.notes}')/items`,
                                {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json;odata=verbose',
                                        'Content-Type': 'application/json;odata=verbose',
                                        'X-RequestDigest': digest
                                    },
                                    credentials: 'include',
                                    body: JSON.stringify({
                                        __metadata: { type: 'SP.Data.SupplierNotesListItem' },
                                        Title: email,
                                        SupplierId: supplierId,
                                        NoteText: noteText,
                                        DateCreated: new Date().toISOString(),
                                        DateModified: new Date().toISOString()
                                    })
                                }
                            );
                            return createResponse.ok;
                        }
                    }
                } catch (error) {
                    console.warn('Error saving note:', error);
                }
                return false;
            }
        }

        // Initialize SharePoint service
        const spService = new SharePointService(SHAREPOINT_CONFIG);
        // Note: useSharePoint declared above, don't redeclare here!
        // Note: storage object declared above, don't redeclare here!

        // ========================================
        // OLD CODE REMOVED - Using new storage object above
        // ========================================
        
        // Generate large supplier dataset
        function generateSuppliers() {
            const suppliers = [];
            const usedNames = new Set();
            const companyTypes = ['Inc.', 'LLC', 'Corp.', 'Co.', 'Supply Co.', 'Distributors', 'Materials', 'Solutions', 'Industries', 'Group', 'Enterprises', 'Services', 'Systems', 'Technologies'];
            const adjectives = ['Premier', 'Elite', 'Pro', 'Superior', 'Quality', 'Reliable', 'National', 'Metro', 'Coastal', 'Summit', 'Precision', 'BuildRight', 'Apex', 'Pioneer', 'TruValue', 'First Choice', 'Top Tier', 'Allied', 'United', 'Global', 'Platinum', 'Diamond', 'Crown', 'Ace', 'Master', 'Prime', 'Advantage', 'American', 'Industrial', 'Commercial', 'Advanced', 'Superior', 'Dynamic', 'Innovative', 'Strategic', 'Certified', 'Professional', 'Executive', 'Specialist', 'Expert', 'Mega', 'Ultra', 'Super', 'Best', 'Direct', 'Express', 'Rapid', 'Swift', 'Instant', 'Quick'];
            const cities = [
                {city: 'New York', state: 'NY', region: 'Northeast'},
                {city: 'Los Angeles', state: 'CA', region: 'West'},
                {city: 'Chicago', state: 'IL', region: 'Midwest'},
                {city: 'Houston', state: 'TX', region: 'Southwest'},
                {city: 'Phoenix', state: 'AZ', region: 'Southwest'},
                {city: 'Philadelphia', state: 'PA', region: 'Northeast'},
                {city: 'San Antonio', state: 'TX', region: 'Southwest'},
                {city: 'San Diego', state: 'CA', region: 'West'},
                {city: 'Dallas', state: 'TX', region: 'Southwest'},
                {city: 'San Jose', state: 'CA', region: 'West'},
                {city: 'Austin', state: 'TX', region: 'Southwest'},
                {city: 'Jacksonville', state: 'FL', region: 'Southeast'},
                {city: 'Fort Worth', state: 'TX', region: 'Southwest'},
                {city: 'Columbus', state: 'OH', region: 'Midwest'},
                {city: 'Charlotte', state: 'NC', region: 'Southeast'},
                {city: 'Seattle', state: 'WA', region: 'West'},
                {city: 'Denver', state: 'CO', region: 'West'},
                {city: 'Boston', state: 'MA', region: 'Northeast'},
                {city: 'Portland', state: 'OR', region: 'West'},
                {city: 'Las Vegas', state: 'NV', region: 'West'},
                {city: 'Detroit', state: 'MI', region: 'Midwest'},
                {city: 'Memphis', state: 'TN', region: 'Southeast'},
                {city: 'Baltimore', state: 'MD', region: 'Northeast'},
                {city: 'Milwaukee', state: 'WI', region: 'Midwest'},
                {city: 'Atlanta', state: 'GA', region: 'Southeast'},
                {city: 'Miami', state: 'FL', region: 'Southeast'},
                {city: 'Indianapolis', state: 'IN', region: 'Midwest'},
                {city: 'Kansas City', state: 'MO', region: 'Midwest'},
                {city: 'Minneapolis', state: 'MN', region: 'Midwest'},
                {city: 'Raleigh', state: 'NC', region: 'Southeast'}
            ];

            let id = 1;
            for (let category in productCategories) {
                const products = productCategories[category];
                const suppliersPerCategory = Math.floor(5000 / Object.keys(productCategories).length);
                
                for (let i = 0; i < suppliersPerCategory; i++) {
                    let supplierName;
                    let adj;
                    let type;
                    let attempts = 0;
                    const categoryShort = category.split(' ')[0];
                    
                    // Generate unique name
                    do {
                        adj = adjectives[Math.floor(seededRandom() * adjectives.length)];
                        type = companyTypes[Math.floor(seededRandom() * companyTypes.length)];
                        supplierName = `${adj} ${categoryShort} ${type}`;
                        attempts++;
                        
                        // Add number suffix if we can't find unique name after 10 attempts
                        if (attempts > 10 && usedNames.has(supplierName)) {
                            supplierName = `${adj} ${categoryShort} ${type} #${Math.floor(seededRandom() * 999 + 1)}`;
                        }
                    } while (usedNames.has(supplierName) && attempts < 20);
                    
                    usedNames.add(supplierName);
                    const cityData = cities[Math.floor(seededRandom() * cities.length)];
                    
                    const numProducts = Math.floor(seededRandom() * 5) + 2;
                    const supplierProducts = [];
                    for (let j = 0; j < numProducts; j++) {
                        const prod = products[Math.floor(seededRandom() * products.length)];
                        if (!supplierProducts.includes(prod)) {
                            supplierProducts.push(prod);
                        }
                    }

                    const numCerts = Math.floor(seededRandom() * 3) + 1;
                    const supplierCerts = [];
                    for (let j = 0; j < numCerts; j++) {
                        const cert = certifications[Math.floor(seededRandom() * certifications.length)];
                        if (!supplierCerts.includes(cert)) {
                            supplierCerts.push(cert);
                        }
                    }

                    suppliers.push({
                        id: id++,
                        name: supplierName,
                        description: `Leading provider of ${category.toLowerCase()} with over ${Math.floor(seededRandom() * 40 + 5)} years of experience. We specialize in delivering high-quality construction materials to commercial and residential projects across the ${cityData.region} region. Our commitment to customer satisfaction and competitive pricing has made us a trusted partner for contractors and builders nationwide.`,
                        website: `https://www.${adj.toLowerCase().replace(/ /g, '')}${categoryShort.toLowerCase()}.com`,
                        email: `${['sales', 'info', 'contact', 'support'][Math.floor(seededRandom() * 4)]}@${adj.toLowerCase().replace(/ /g, '')}${categoryShort.toLowerCase()}.com`,
                        phone: `(${Math.floor(seededRandom() * 900 + 200)}) ${Math.floor(seededRandom() * 900 + 200)}-${Math.floor(seededRandom() * 9000 + 1000)}`,
                        address: `${Math.floor(seededRandom() * 9000 + 1000)} ${['Main', 'Oak', 'Maple', 'Industrial', 'Commerce', 'Market', 'Park', 'Center'][Math.floor(seededRandom() * 8)]} ${['Street', 'Avenue', 'Boulevard', 'Drive', 'Way', 'Road'][Math.floor(seededRandom() * 6)]}`,
                        city: cityData.city,
                        state: cityData.state,
                        category: category,
                        products: supplierProducts,
                        location: `${cityData.city}, ${cityData.state}`,
                        region: cityData.region,
                        rating: (seededRandom() * 1.5 + 3.5).toFixed(1),
                        aiScore: Math.floor(seededRandom() * 30 + 70),
                        certifications: supplierCerts,
                        size: companySizes[Math.floor(seededRandom() * companySizes.length)],
                        priceRange: priceRanges[Math.floor(seededRandom() * priceRanges.length)],
                        yearsInBusiness: Math.floor(seededRandom() * 40 + 5),
                        projectsCompleted: Math.floor(seededRandom() * 5000 + 100),
                        walmartVerified: seededRandom() > 0.7,
                        employees: Math.floor(seededRandom() * 900 + 50),
                        responseTime: Math.floor(seededRandom() * 24 + 1) + ' hours',
                        minOrder: '$' + (Math.floor(seededRandom() * 50 + 10) * 100).toLocaleString(),
                        paymentTerms: ['Net 30', 'Net 60', '2/10 Net 30', 'Credit Card', 'COD'][Math.floor(seededRandom() * 5)],
                    });
                }
            }
            return suppliers;
        }

        // Load suppliers from API instead of generating locally
        // NOTE: Variables already declared above (lines 1827+):
        // - allSuppliers
        // - filteredSuppliers  
        // - currentPage
        // - itemsPerPage
        // DO NOT REDECLARE THEM HERE!
        
        // Async function to load suppliers from server
        async function loadSuppliersFromServer() {
            try {
                // FIRST: Test if server is reachable
                console.log('ðŸ” Testing server connection first...');
                console.log(`   API_BASE: ${API_BASE}`);
                console.log(`   Test URL: ${API_BASE}/api/test`);
                
                let testResponse;
                try {
                    testResponse = await fetch(`${API_BASE}/api/test`, { timeout: 5000 });
                    const testData = await testResponse.json();
                    console.log(`   âœ… Server test successful!`);
                    console.log(`   Server returned: ${testData.suppliersCount} suppliers loaded on server`);
                } catch (testError) {
                    console.error(`   âŒ Server test failed:`, testError.message);
                    console.log(`   This means the API endpoint is not reachable`);
                    throw testError;
                }
                
                // If we got here, server is up. Now fetch suppliers
                console.log('\nðŸŒ Fetching suppliers from server...');
                console.log(`   Full URL: ${API_BASE}/api/suppliers`);
                
                const response = await fetch(`${API_BASE}/api/suppliers`);
                
                console.log(`   Response status: ${response.status} ${response.statusText}`);
                console.log(`   Response OK: ${response.ok}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log(`   Response data:`, data);
                console.log(`   Data success: ${data.success}`);
                console.log(`   Data has .data: ${!!data.data}`);
                console.log(`   Data.data is array: ${Array.isArray(data.data)}`);
                if (data.data) {
                    console.log(`   Data.data length: ${data.data.length}`);
                }
                
                if (data.success && data.data && Array.isArray(data.data)) {
                    allSuppliers = data.data;
                    filteredSuppliers = [...allSuppliers];
                    
                    // Save suppliers to localStorage for reference
                    try {
                        localStorage.setItem('allSuppliers', JSON.stringify(allSuppliers));
                    } catch (e) {
                        console.warn('Could not save to localStorage:', e);
                    }
                    
                    console.log(`âœ… Loaded ${allSuppliers.length} suppliers from server!`);
                    console.log('ðŸ“Š Data source: SERVER (Live Data)');
                    
                    // Update status in toolbar
                    const statusElem = document.getElementById('spStatus');
                    if (statusElem) {
                        statusElem.innerHTML = 'â˜ï¸ Server (Live Data)';
                        statusElem.style.color = '#4ade80';
                        statusElem.style.opacity = '1';
                    }
                    
                    return true;
                } else {
                    throw new Error(`Invalid response format - success: ${data.success}, has data: ${!!data.data}, is array: ${Array.isArray(data.data)}`);
                }
            } catch (error) {
                console.error('\nâŒ FAILED to load from server:', error);
                console.error('   Error name:', error.name);
                console.error('   Error message:', error.message);
                console.error('   Error stack:', error.stack);
                
                // Diagnostic info
                console.error('\nðŸ” DIAGNOSTIC INFO:');
                console.error(`   API_BASE: ${API_BASE}`);
                console.error(`   Current origin: ${window.location.origin}`);
                console.error(`   Current href: ${window.location.href}`);
                console.error(`   API URL attempted: ${API_BASE}/api/suppliers`);
                
                // Common causes
                if (error.message.includes('404')) {
                    console.error('\n   ðŸ”´ ISSUE: API endpoint returns 404 (Not Found)');
                    console.error('   CHECK: Does /api/suppliers endpoint exist in server.js?');
                } else if (error.message.includes('Failed to fetch')) {
                    console.error('\n   ðŸ”´ ISSUE: Network error - Cannot reach server at all');
                    console.error('   CHECK: Is server running?');
                    console.error('   CHECK: Are frontend and API on same origin?');
                    console.error('   CHECK: CORS headers correct?');
                } else if (error.message.includes('JSON')) {
                    console.error('\n   ðŸ”´ ISSUE: Response is not valid JSON');
                    console.error('   CHECK: Is /api/suppliers returning JSON?');
                }
                
                console.log('\nðŸ”„ Falling back to local data generation...');
                
                // Fallback to local generation
                allSuppliers = generateSuppliers();
                filteredSuppliers = [...allSuppliers];
                
                // Save suppliers to localStorage
                try {
                    localStorage.setItem('allSuppliers', JSON.stringify(allSuppliers));
                } catch (e) {
                    console.warn('Could not save to localStorage:', e);
                }
                
                console.log(`âœ… Loaded ${allSuppliers.length} suppliers locally`);
                console.log('ðŸ“Š Data source: LOCAL (Seeded Data)');
                
                // Update status in toolbar
                const statusElem = document.getElementById('spStatus');
                if (statusElem) {
                    statusElem.innerHTML = 'ðŸ’¾ Local (Seeded Data)';
                    statusElem.style.color = '#f59e0b';
                    statusElem.style.opacity = '1';
                }
                
                return false;
            }
        }
        
        // Initialize suppliers (will be called on page load)
        // This will be called after checkUserSession() completes

        // Toggle filter section collapse
        function toggleFilterSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId + '-icon');
            
            if (section.classList.contains('collapsed')) {
                section.classList.remove('collapsed');
                icon.textContent = 'â–¼';
            } else {
                section.classList.add('collapsed');
                icon.textContent = 'â–²';
            }
        }

        let allCollapsed = false;
        function toggleAllFilters() {
            const sections = document.querySelectorAll('.filter-content');
            const icons = document.querySelectorAll('.collapse-icon');
            const btnText = document.getElementById('collapseAllText');
            
            allCollapsed = !allCollapsed;
            
            sections.forEach(section => {
                if (allCollapsed) {
                    section.classList.add('collapsed');
                } else {
                    section.classList.remove('collapsed');
                }
            });
            
            icons.forEach(icon => {
                icon.textContent = allCollapsed ? 'â–²' : 'â–¼';
            });
            
            btnText.textContent = allCollapsed ? 'EXPAND ALL' : 'COLLAPSE ALL';
        }

        function filterByStat(type) {
            // Clear existing filters
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('searchInput').value = '';
            
            if (type === 'all') {
                // Show all suppliers
                filteredSuppliers = [...allSuppliers];
                currentPage = 1;
                renderResults();
            } else if (type === 'verified') {
                // Filter to only verified suppliers
                filteredSuppliers = allSuppliers.filter(s => s.walmartVerified);
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`âœ… Showing ${filteredSuppliers.length} Walmart Verified suppliers`);
            } else if (type === 'categories') {
                // Sort by category (alphabetically), then by name
                filteredSuppliers = [...allSuppliers].sort((a, b) => {
                    if (a.category < b.category) return -1;
                    if (a.category > b.category) return 1;
                    return a.name.localeCompare(b.name);
                });
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`ðŸ“Š Sorted by ${Object.keys(productCategories).length} categories`);
            } else if (type === 'products') {
                // Sort by number of products (most to least)
                filteredSuppliers = [...allSuppliers].sort((a, b) => b.products.length - a.products.length);
                currentPage = 1;
                renderResults();
                
                // Show notification
                showNotification(`ðŸ“¦ Sorted by product count (${filteredSuppliers[0].products.length} max)`);
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showNotification(message) {
            // Remove existing notification if any
            const existing = document.getElementById('filterNotification');
            if (existing) existing.remove();
            
            // Create notification
            const notification = document.createElement('div');
            notification.id = 'filterNotification';
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--walmart-blue);
                color: white;
                padding: 15px 25px;
                border: 3px solid var(--walmart-yellow);
                box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.2);
                z-index: 9999;
                font-family: var(--accent-font);
                font-weight: 600;
                font-size: 0.9rem;
                letter-spacing: 0.5px;
                animation: slideInBottom 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutBottom 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ðŸ†• Category Modal Functions
        function showCategoryModal() {
            const categoryModal = document.getElementById('categoryModal');
            const categoryModalBody = document.getElementById('categoryModalBody');
            
            // Get all unique categories with supplier counts
            const categoryMap = new Map();
            allSuppliers.forEach(s => {
                const count = categoryMap.get(s.category) || 0;
                categoryMap.set(s.category, count + 1);
            });
            
            // Sort categories alphabetically
            const categories = Array.from(categoryMap.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            
            console.log(`ðŸ“š Showing ${categories.length} categories`);
            
            // Create category cards
            categoryModalBody.innerHTML = categories.map(([category, count]) => {
                // Get emoji for category
                const categoryEmoji = getCategoryEmoji(category);
                
                return `
                    <div class="category-card" onclick="selectCategory('${category.replace(/'/g, "\'")}')">
                        <div class="category-icon">${categoryEmoji}</div>
                        <div class="category-name">${category}</div>
                        <div class="category-count">${count} suppliers</div>
                    </div>
                `;
            }).join('');
            
            // Show modal
            categoryModal.classList.add('active');
        }
        
        function selectCategory(category) {
            console.log(`ðŸ·ï¸ Selected category: ${category}`);
            
            // Filter suppliers by category
            filteredSuppliers = allSuppliers.filter(s => s.category === category);
            currentPage = 1;
            
            // Close modal
            document.getElementById('categoryModal').classList.remove('active');
            
            // Render results
            renderResults();
            
            // Show notification
            const count = filteredSuppliers.length;
            showNotification(`âœ… Showing ${count} ${category} suppliers`);
            
            // Scroll to results
            setTimeout(() => {
                const resultsArea = document.querySelector('.results-area');
                if (resultsArea) {
                    resultsArea.scrollIntoView({ behavior: 'smooth' });
                }
            }, 300);
        }
        
        function getCategoryEmoji(category) {
            // Map categories to emojis
            const emojiMap = {
                'Personal Protective Equipment': 'ðŸ‘·',
                'Electrical': 'âš¡',
                'Plumbing': 'ðŸš°',
                'HVAC': 'â„ï¸',
                'Steel & Metal': 'ðŸ—ï¸',
                'Concrete & Cement': 'ðŸ§±',
                'Lumber & Wood': 'ðŸªµ',
                'Flooring': 'ðŸ ',
                'Roofing Materials': 'ðŸ¢',
                'Windows & Doors': 'ðŸªŸ',
                'Tools & Equipment': 'ðŸ”§',
                'Safety & Security Fixtures': 'ðŸ”’',
                'Insulation': 'ðŸ›¡ï¸',
                'Paint & Coatings': 'ðŸŽ¨',
                'Fasteners & Hardware': 'ðŸ”©',
                'Lighting Fixtures': 'ðŸ’¡',
                'Flooring': 'ðŸ˜ï¸',
                'Drywall & Gypsum': 'ðŸ“¦',
                'Masonry': 'â›ï¸',
                'Adhesives & Sealants': 'ðŸ§´',
                'Flooring': 'â¬œ',
                'Commercial Refrigeration': 'â„ï¸',
                'Commercial Kitchen Equipment': 'ðŸ³',
                'Retail Fixtures & Displays': 'ðŸ›ï¸',
                'Material Handling Equipment': 'ðŸ‹ï¸',
                'Waste Management Systems': 'â™»ï¸',
                'Signage & Wayfinding': 'ðŸš©',
                'Landscape & Site Work': 'ðŸŒ³',
                'Emergency Power Systems': 'âš¡',
                'Building Automation & Controls': 'ðŸ¤–',
            };
            
            return emojiMap[category] || 'ðŸ“š';
        }
        
        // Close category modal
        document.addEventListener('DOMContentLoaded', function() {
            const categoryModalClose = document.getElementById('categoryModalClose');
            const categoryModal = document.getElementById('categoryModal');
            
            if (categoryModalClose) {
                categoryModalClose.addEventListener('click', () => {
                    categoryModal.classList.remove('active');
                });
            }
            
            if (categoryModal) {
                categoryModal.addEventListener('click', (e) => {
                    if (e.target === categoryModal) {
                        categoryModal.classList.remove('active');
                    }
                });
            }
        });

        // NOTE: compareList and currentView already declared above (lines 1840-1841)
        // DO NOT REDECLARE THEM HERE!
        let compareMode = false;  // This one is unique, keep it
        
        function toggleCompareMode() {
            if (compareList.length < 2) {
                alert('âš ï¸ Please select at least 2 suppliers to compare!');
                return;
            }
            showComparisonView();
        }

        function toggleCompareSupplier(supplierId) {
            const checkbox = document.getElementById(`compare-${supplierId}`);
            
            if (checkbox.checked) {
                if (compareList.length >= 5) {
                    checkbox.checked = false;
                    alert('âš ï¸ You can compare up to 5 suppliers at once.');
                    return;
                }
                compareList.push(supplierId);
            } else {
                compareList = compareList.filter(id => id !== supplierId);
            }
            
            updateCompareBtnText();
        }

        function updateCompareBtnText() {
            const btn = document.getElementById('compareBtnText');
            btn.textContent = `COMPARE (${compareList.length})`;
            
            // Enable/disable compare button
            const compareBtn = btn.parentElement;
            if (compareList.length >= 2) {
                compareBtn.style.background = 'var(--walmart-blue)';
                compareBtn.style.color = 'white';
                compareBtn.style.borderColor = 'var(--walmart-blue)';
            } else {
                compareBtn.style.background = 'white';
                compareBtn.style.color = '#666';
                compareBtn.style.borderColor = '#ddd';
            }
        }

        function showComparisonView() {
            const suppliers = compareList.map(id => allSuppliers.find(s => s.id === id));
            
            const comparisonHTML = `
                <div class="comparison-modal" id="comparisonModal">
                    <div class="comparison-content">
                        <div class="comparison-header">
                            <h2 style="font-family: var(--heading-font); font-size: 2rem; letter-spacing: 2px;">âš–ï¸ SUPPLIER COMPARISON</h2>
                            <button onclick="closeComparison()" class="modal-close">âœ•</button>
                        </div>
                        <div class="comparison-table-wrapper">
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>METRIC</th>
                                        ${suppliers.map(s => `<th>${s.name}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>AI Score</strong></td>
                                        ${suppliers.map(s => `<td class="score-cell">ðŸ¤– ${s.aiScore}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Rating</strong></td>
                                        ${suppliers.map(s => `<td>â­ ${s.rating}/5.0</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Location</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ“ ${s.location}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Company Size</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ¢ ${s.size}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Years in Business</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ“… ${s.yearsInBusiness} years</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Employees</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ‘¥ ${s.employees}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Response Time</strong></td>
                                        ${suppliers.map(s => `<td>â±ï¸ ${s.responseTime}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Min Order</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ’µ ${s.minOrder}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Payment Terms</strong></td>
                                        ${suppliers.map(s => `<td>ðŸ’³ ${s.paymentTerms}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Walmart Verified</strong></td>
                                        ${suppliers.map(s => `<td>${s.walmartVerified ? 'âœ… Yes' : 'âŒ No'}</td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Products</strong></td>
                                        ${suppliers.map(s => `<td><small>${s.products.join(', ')}</small></td>`).join('')}
                                    </tr>
                                    <tr>
                                        <td><strong>Certifications</strong></td>
                                        ${suppliers.map(s => `<td><small>${s.certifications.join(', ')}</small></td>`).join('')}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', comparisonHTML);
        }

        function closeComparison() {
            const modal = document.getElementById('comparisonModal');
            if (modal) modal.remove();
        }

        function switchView(view) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`view${view.charAt(0).toUpperCase() + view.slice(1)}`).classList.add('active');
            
            // Re-render with new view
            renderResults();
        }

        function exportResults() {
            const csvContent = "data:text/csv;charset=utf-8,"
                + "Name,Location,Category,Rating,AI Score,Products,Verified\n"
                + filteredSuppliers.map(s => 
                    `"${s.name}","${s.location}","${s.category}",${s.rating},${s.aiScore},${s.products.length},${s.walmartVerified}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "walmart_suppliers.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function printResults() {
            window.print();
        }

        function clearAllFilters() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('searchInput').value = '';
            document.getElementById('sortSelect').value = 'relevance';
            applyFilters();
        }

        function filterByTag(productName) {
            // Clear existing filters
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Check the matching product checkbox if it exists
            const productCheckboxes = document.querySelectorAll('#productTypeFilters input[type="checkbox"]');
            productCheckboxes.forEach(cb => {
                if (cb.value === productName) {
                    cb.checked = true;
                }
            });
            
            // Also set search to the product name
            document.getElementById('searchInput').value = productName;
            
            // Apply filters
            applyFilters();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize filters
        function initializeFilters() {
            console.log('ðŸ“Š Initializing filters with', allSuppliers.length, 'suppliers');
            
            // Vendors - show top 20 unique vendor names
            const vendorContainer = document.getElementById('vendorFilters');
            const uniqueVendors = [...new Set(allSuppliers.map(s => s.name))]
                .sort()
                .slice(0, 50); // Show first 50 vendors
            
            console.log('   Found', uniqueVendors.length, 'unique vendors');
            
            let allVendors = uniqueVendors;
            
            function renderVendors(vendors) {
                vendorContainer.innerHTML = vendors.map(vendor => {
                    const count = allSuppliers.filter(s => s.name === vendor).length;
                    return `
                        <div class="filter-option">
                            <input type="checkbox" id="vendor-${vendor.replace(/[^a-zA-Z0-9]/g, '')}" value="${vendor}" class="vendor-filter">
                            <label for="vendor-${vendor.replace(/[^a-zA-Z0-9]/g, '')}">${vendor}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                }).join('');
                
                // Re-attach event listeners
                document.querySelectorAll('.vendor-filter').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
            }
            
            renderVendors(allVendors);
            
            // Vendor search functionality
            document.getElementById('vendorSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                if (searchTerm) {
                    const filtered = uniqueVendors.filter(v => v.toLowerCase().includes(searchTerm));
                    renderVendors(filtered);
                } else {
                    renderVendors(allVendors);
                }
            });
            // Categories - show first 10, rest hidden
            const categoryContainer = document.getElementById('categoryFilters');
            categoryContainer.innerHTML = '';  // CLEAR existing content first!
            
            const allCategories = Object.keys(productCategories);
            const initialCategoryCount = 10;
            
            let categoryHTML = '';
            allCategories.forEach((cat, index) => {
                const count = allSuppliers.filter(s => s.category === cat).length;
                const isHidden = index >= initialCategoryCount;
                categoryHTML += `
                    <div class="filter-option ${isHidden ? 'hidden-category' : ''}">
                        <input type="checkbox" id="cat-${cat}" value="${cat}" class="category-filter">
                        <label for="cat-${cat}">${cat}</label>
                        <span class="filter-count">(${count})</span>
                    </div>
                `;
            });
            
            if (allCategories.length > initialCategoryCount) {
                categoryHTML += `
                    <div class="filter-expand" onclick="toggleCategories()" id="categoryToggle">
                        <span id="categoryToggleIcon">â–¼</span> Show More (${allCategories.length - initialCategoryCount} more)
                    </div>
                `;
            }
            
            categoryContainer.innerHTML = categoryHTML;

            // Product Types - get all unique products from suppliers
            const productContainer = document.getElementById('productTypeFilters');
            productContainer.innerHTML = '';  // CLEAR existing content first!
            
            const allProducts = [...new Set(
                allSuppliers.flatMap(s => s.products || [])
            )].sort();
            
            console.log('   Found', allProducts.length, 'unique products');
            
            let productHTML = '';
            if (allProducts.length > 0) {
                allProducts.slice(0, 20).forEach(prod => {
                    const count = allSuppliers.filter(s => s.products && s.products.includes(prod)).length;
                    if (count > 0) {
                        const prodId = prod.replace(/[^a-zA-Z0-9]/g, '');
                        productHTML += `
                            <div class="filter-option">
                                <input type="checkbox" id="prod-${prodId}" value="${prod}" class="product-filter">
                                <label for="prod-${prodId}">${prod}</label>
                                <span class="filter-count">(${count})</span>
                            </div>
                        `;
                    }
                });
                
                // Show "More" button if there are more products
                if (allProducts.length > 20) {
                    productHTML += `
                        <div style="padding: 10px; text-align: center; cursor: pointer; color: #0071ce; font-weight: 600;" onclick="alert('Showing top 20 products. There are ${allProducts.length} total products available.')">
                            + ${allProducts.length - 20} more products
                        </div>
                    `;
                }
            } else {
                productHTML = '<p style="color: #999;">No products available</p>';
            }
            productContainer.innerHTML = productHTML;

            // Fixtures & Hardware - Get all unique products and organize by first letter/group
            const fixtureContainer = document.getElementById('fixtureFilters');
            fixtureContainer.innerHTML = '';  // CLEAR existing content first!
            
            const fixtureProducts = [...new Set(
                allSuppliers.flatMap(s => s.products || [])
            )].sort();
            
            console.log('   Found', fixtureProducts.length, 'products for fixtures');
            
            let fixtureHTML = '';
            if (fixtureProducts.length > 0) {
                // Group products by first letter or common prefix
                const groupedProducts = {};
                fixtureProducts.forEach(prod => {
                    const firstChar = prod.charAt(0).toUpperCase();
                    if (!groupedProducts[firstChar]) {
                        groupedProducts[firstChar] = [];
                    }
                    groupedProducts[firstChar].push(prod);
                });
                
                // Render grouped products
                Object.entries(groupedProducts).forEach(([letter, prods], index) => {
                    const subcatId = 'fixture-' + letter;
                    const isExpanded = index < 2; // First 2 groups expanded by default
                    
                    fixtureHTML += `
                        <div class="fixture-subcategory">
                            <div class="fixture-subcategory-title" onclick="toggleFixtureCategory('${subcatId}')">
                                <span id="icon-${subcatId}">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                                ${letter} (${prods.length})
                            </div>
                            <div class="fixture-products ${isExpanded ? '' : 'collapsed'}" id="${subcatId}">
                                ${prods.map(prod => {
                                    const count = allSuppliers.filter(s => s.products && s.products.includes(prod)).length;
                                    const prodId = prod.replace(/[^a-zA-Z0-9]/g, '');
                                    return count > 0 ? `
                                        <div class="filter-option">
                                            <input type="checkbox" id="fixture-${prodId}" value="${prod}" class="product-filter fixture-filter">
                                            <label for="fixture-${prodId}">${prod}</label>
                                            <span class="filter-count">(${count})</span>
                                        </div>
                                    ` : '';
                                }).join('')}
                            </div>
                        </div>
                    `;
                });
                fixtureContainer.innerHTML = fixtureHTML;
            } else {
                fixtureContainer.innerHTML = '<p style="color: #999;">No fixtures available</p>';
            }

            // Regions - get unique states from supplier locations
            const regionContainer = document.getElementById('regionFilters');
            const uniqueStates = [...new Set(
                allSuppliers.map(s => s.state || s.location?.split(', ')[1]).filter(Boolean)
            )].sort();
            
            console.log('   Found', uniqueStates.length, 'unique states/regions');
            
            if (uniqueStates.length > 0) {
                uniqueStates.forEach(state => {
                    const count = allSuppliers.filter(s => (s.state === state) || (s.location && s.location.includes(state))).length;
                    const stateId = state.replace(/[^a-zA-Z0-9]/g, '');
                    regionContainer.innerHTML += `
                        <div class="filter-option">
                            <input type="checkbox" id="reg-${stateId}" value="${state}" class="region-filter">
                            <label for="reg-${stateId}">${state}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                });
            } else {
                regionContainer.innerHTML = '<p style="color: #999;">No regions available</p>';
            }

            // Certifications - get unique certifications from suppliers
            const certContainer = document.getElementById('certFilters');
            const uniqueCerts = [...new Set(
                allSuppliers.flatMap(s => s.certifications || [])
            )].sort();
            
            console.log('   Found', uniqueCerts.length, 'unique certifications');
            
            if (uniqueCerts.length > 0) {
                uniqueCerts.forEach(cert => {
                    const count = allSuppliers.filter(s => s.certifications && s.certifications.includes(cert)).length;
                    const certId = cert.replace(/[^a-zA-Z0-9]/g, '');
                    certContainer.innerHTML += `
                        <div class="filter-option">
                            <input type="checkbox" id="cert-${certId}" value="${cert}" class="cert-filter">
                            <label for="cert-${certId}">${cert}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                });
            } else {
                certContainer.innerHTML = '<p style="color: #999;">No certifications available</p>';
            }

            // Company Size - get unique employee counts and group them
            const sizeContainer = document.getElementById('sizeFilters');
            const sizes = [
                { label: 'Small (1-50)', min: 1, max: 50 },
                { label: 'Medium (51-500)', min: 51, max: 500 },
                { label: 'Large (501-1000)', min: 501, max: 1000 },
                { label: 'Enterprise (1000+)', min: 1000, max: Infinity }
            ];
            
            sizes.forEach((size, idx) => {
                const count = allSuppliers.filter(s => {
                    const emp = s.employees || 0;
                    return emp >= size.min && emp <= size.max;
                }).length;
                
                if (count > 0) {
                    const sizeId = size.label.replace(/[^a-zA-Z0-9]/g, '');
                    sizeContainer.innerHTML += `
                        <div class="filter-option">
                            <input type="checkbox" id="size-${sizeId}" value="${size.label}" class="size-filter">
                            <label for="size-${sizeId}">${size.label}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                }
            });

            // Price Range - generate based on AI scores or other metric
            const priceContainer = document.getElementById('priceFilters');
            const priceRanges = [
                { label: 'Budget', min: 0, max: 50 },
                { label: 'Standard', min: 51, max: 75 },
                { label: 'Premium', min: 76, max: 90 },
                { label: 'Enterprise', min: 91, max: 100 }
            ];
            
            priceRanges.forEach((range) => {
                const count = allSuppliers.filter(s => {
                    const score = s.aiScore || 0;
                    return score >= range.min && score <= range.max;
                }).length;
                
                if (count > 0) {
                    const rangeId = range.label.replace(/[^a-zA-Z0-9]/g, '');
                    priceContainer.innerHTML += `
                        <div class="filter-option">
                            <input type="checkbox" id="price-${rangeId}" value="${range.label}" class="price-filter">
                            <label for="price-${rangeId}">${range.label}</label>
                            <span class="filter-count">(${count})</span>
                        </div>
                    `;
                }
            });

            // Add event listeners
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', applyFilters);
            });
        }

        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const selectedVendors = Array.from(document.querySelectorAll('.vendor-filter:checked')).map(cb => cb.value);
            const selectedCategories = Array.from(document.querySelectorAll('.category-filter:checked')).map(cb => cb.value);
            const selectedProducts = Array.from(document.querySelectorAll('.product-filter:checked')).map(cb => cb.value);
            const selectedRegions = Array.from(document.querySelectorAll('.region-filter:checked')).map(cb => cb.value);
            const selectedCerts = Array.from(document.querySelectorAll('.cert-filter:checked')).map(cb => cb.value);
            const selectedSizes = Array.from(document.querySelectorAll('.size-filter:checked')).map(cb => cb.value);
            const selectedPrices = Array.from(document.querySelectorAll('.price-filter:checked')).map(cb => cb.value);

            filteredSuppliers = allSuppliers.filter(supplier => {
                const matchesSearch = !searchTerm || 
                    supplier.name.toLowerCase().includes(searchTerm) ||
                    supplier.category.toLowerCase().includes(searchTerm) ||
                    (supplier.products && supplier.products.some(p => p.toLowerCase().includes(searchTerm))) ||
                    supplier.location.toLowerCase().includes(searchTerm);

                const matchesVendor = selectedVendors.length === 0 || selectedVendors.includes(supplier.name);
                const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(supplier.category);
                const matchesProduct = selectedProducts.length === 0 || (supplier.products && supplier.products.some(p => selectedProducts.includes(p)));
                
                // Region: check state field
                const matchesRegion = selectedRegions.length === 0 || 
                    selectedRegions.some(region => supplier.state === region || supplier.location.includes(region));
                
                // Cert: check certifications array
                const matchesCert = selectedCerts.length === 0 || 
                    (supplier.certifications && supplier.certifications.some(c => selectedCerts.includes(c)));
                
                // Size: check employee count
                const matchesSize = selectedSizes.length === 0 || selectedSizes.some(size => {
                    if (size.includes('Small')) return (supplier.employees || 0) >= 1 && (supplier.employees || 0) <= 50;
                    if (size.includes('Medium')) return (supplier.employees || 0) >= 51 && (supplier.employees || 0) <= 500;
                    if (size.includes('Large')) return (supplier.employees || 0) >= 501 && (supplier.employees || 0) <= 1000;
                    if (size.includes('Enterprise')) return (supplier.employees || 0) >= 1000;
                    return false;
                });
                
                // Price: check AI score
                const matchesPrice = selectedPrices.length === 0 || selectedPrices.some(price => {
                    const score = supplier.aiScore || 0;
                    if (price.includes('Budget')) return score >= 0 && score <= 50;
                    if (price.includes('Standard')) return score >= 51 && score <= 75;
                    if (price.includes('Premium')) return score >= 76 && score <= 90;
                    if (price.includes('Enterprise')) return score >= 91 && score <= 100;
                    return false;
                });

                return matchesSearch && matchesVendor && matchesCategory && matchesProduct && matchesRegion && matchesCert && matchesSize && matchesPrice;
            });

            currentPage = 1;
            renderResults();
        }

        // Render catalog card
        function renderCatalogCard(supplier) {
            const isFavorited = userData && userData.favorites && userData.favorites.includes(supplier.id);
            const hasNote = userData && userData.notes && userData.notes[supplier.id];
            
            return `
                <div class="supplier-catalog-card">
                    <div class="catalog-header">
                        <div class="catalog-name">${supplier.name}</div>
                        <div class="catalog-category">${supplier.category}</div>
                    </div>
                    <div class="catalog-body">
                        <div class="catalog-stat">
                            <span>AI Score</span>
                            <strong>${supplier.aiScore}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Rating</span>
                            <strong>${supplier.rating}/5.0</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Location</span>
                            <strong>${supplier.city}, ${supplier.state}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Products</span>
                            <strong>${supplier.products.length}</strong>
                        </div>
                        <div class="catalog-stat">
                            <span>Years</span>
                            <strong>${supplier.yearsInBusiness}</strong>
                        </div>
                        ${supplier.walmartVerified ? '<div class="catalog-stat"><span>Verified</span><strong>Yes</strong></div>' : ''}
                        <div class="catalog-actions">
                            <button class="favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite(${supplier.id})" id="fav-${supplier.id}" style="font-size: 1.5rem; flex: 1;">
                                â¤ï¸
                            </button>
                            <button class="note-btn ${hasNote ? 'has-note' : ''}" onclick="openNoteModal('${supplier.id}')" style="flex: 2;">
                                NOTES
                            </button>
                            <button class="btn btn-primary" onclick="openSupplierModal('${supplier.id}')" style="flex: 3; padding: 10px; font-size: 0.8rem;">
                                VIEW
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render results
        function renderResults() {
            const container = document.getElementById('resultsContainer');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageSuppliers = filteredSuppliers.slice(start, end);

            console.log('ðŸŽ¨ renderResults called');
            console.log('ðŸ“Š pageSuppliers count:', pageSuppliers.length);
            if (pageSuppliers.length > 0) {
                console.log('ðŸ” First supplier object:', pageSuppliers[0]);
                console.log('ðŸ” First supplier ID field:', pageSuppliers[0].id);
                console.log('ðŸ” First supplier keys:', Object.keys(pageSuppliers[0]));
            }

            document.getElementById('resultsCount').textContent = filteredSuppliers.length.toLocaleString();
            document.getElementById('toolbarResultCount').textContent = filteredSuppliers.length.toLocaleString();

            // Apply view-specific class to container
            container.className = currentView === 'grid' ? 'results-grid' : currentView === 'catalog' ? 'results-catalog' : '';

            if (currentView === 'catalog') {
                container.innerHTML = pageSuppliers.map(supplier => renderCatalogCard(supplier)).join('');
            } else {
                container.innerHTML = pageSuppliers.map(supplier => `
                <div class="supplier-item">
                    <div class="supplier-header">
                        <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                            <input type="checkbox" 
                                class="compare-checkbox" 
                                id="compare-${supplier.id}" 
                                onchange="toggleCompareSupplier('${supplier.id}')" 
                                ${compareList.includes(supplier.id) ? 'checked' : ''}
                                title="Select for comparison">
                            <button class="favorite-btn" onclick="toggleFavorite('${supplier.id}')" id="fav-${supplier.id}" title="Add to favorites">
                                â¤ï¸
                            </button>
                            <div class="supplier-name" onclick="openSupplierModal('${supplier.id}')" style="cursor: pointer;">
                                ${supplier.name}
                                ${supplier.walmartVerified ? '<span class="walmart-verified">âœ“ Walmart Verified</span>' : ''}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="note-btn" onclick="openNoteModal('${supplier.id}')" title="Add/view notes">
                                NOTE
                            </button>
                            <span class="ai-score">AI: ${supplier.aiScore}</span>
                        </div>
                    </div>
                    <div class="supplier-meta">
                        <span class="meta-item">${supplier.location}, ${supplier.region}</span>
                        <span class="meta-item">Rating: ${supplier.rating}/5.0</span>
                        <span class="meta-item">${supplier.size}</span>
                        <span class="meta-item">${supplier.priceRange}</span>
                        <span class="meta-item">${supplier.yearsInBusiness} years</span>
                    </div>
                    <div class="supplier-products">
                        <strong>Products:</strong>
                        <div class="product-tags">
                            ${supplier.products.map((p, i) => `<span class="tag ${i === 0 ? 'featured' : ''}" onclick="filterByTag('${p.replace(/'/g, "\\'")}')" title="Click to filter by ${p}" style="cursor: pointer;">${p}</span>`).join('')}
                        </div>
                    </div>
                    <div class="supplier-certifications">
                        ${supplier.certifications.map(c => `<span class="cert-badge">âœ“ ${c}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            }

            renderPagination();
            
            // Update favorite and note buttons after rendering
            setTimeout(() => {
                updateFavoriteButtons();
                updateNoteButtons();
            }, 0);
        }

        // Pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            let html = `
                <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>â† Previous</button>
            `;

            const maxButtons = 7;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            if (startPage > 1) {
                html += `<button class="page-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) html += `<span>...</span>`;
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span>...</span>`;
                html += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }

            html += `
                <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>Next â†’</button>
            `;

            pagination.innerHTML = html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredSuppliers.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderResults();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Autocomplete
        const searchInput = document.getElementById('searchInput');
        const autocomplete = document.getElementById('autocomplete');
        const clearSearch = document.getElementById('clearSearch');

        searchInput.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            clearSearch.style.display = value ? 'block' : 'none';

            if (value.length < 2) {
                autocomplete.classList.remove('active');
                applyFilters();
                return;
            }

            const suggestions = [];
            
            // Search suppliers
            allSuppliers.forEach(s => {
                if (s.name.toLowerCase().includes(value)) {
                    suggestions.push({ type: 'supplier', text: s.name, category: s.category });
                }
            });

            // Search products
            Object.values(productCategories).flat().forEach(p => {
                if (p.toLowerCase().includes(value) && !suggestions.find(s => s.text === p)) {
                    suggestions.push({ type: 'product', text: p, category: 'Product' });
                }
            });

            if (suggestions.length > 0) {
                autocomplete.innerHTML = suggestions.slice(0, 8).map(s => `
                    <div class="autocomplete-item" onclick="selectSuggestion('${s.text.replace(/'/g, "\\'")}')">
                        <span class="icon">${s.type === 'supplier' ? 'ðŸ¢' : 'ðŸ“¦'}</span>
                        <span class="text">${s.text}</span>
                        <span class="category">${s.category}</span>
                    </div>
                `).join('');
                autocomplete.classList.add('active');
            } else {
                autocomplete.classList.remove('active');
            }

            applyFilters();
        });

        function selectSuggestion(text) {
            searchInput.value = text;
            autocomplete.classList.remove('active');
            applyFilters();
        }

        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            clearSearch.style.display = 'none';
            autocomplete.classList.remove('active');
            applyFilters();
        });

        // Sort
        document.getElementById('sortSelect').addEventListener('change', function() {
            const sortBy = this.value;
            
            switch(sortBy) {
                case 'score-high':
                    filteredSuppliers.sort((a, b) => b.aiScore - a.aiScore);
                    break;
                case 'score-low':
                    filteredSuppliers.sort((a, b) => a.aiScore - b.aiScore);
                    break;
                case 'name-asc':
                    filteredSuppliers.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'name-desc':
                    filteredSuppliers.sort((a, b) => b.name.localeCompare(a.name));
                    break;
                case 'rating':
                    filteredSuppliers.sort((a, b) => b.rating - a.rating);
                    break;
            }
            
            renderResults();
        });

        // Supplier Modal
        function openSupplierModal(supplierId) {
            // SIMPLE ALERT TEST
            alert('SUPPLIER CLICKED! ID: ' + supplierId);
            
            try {
                console.log('\n' + '='.repeat(60));
                console.log('ðŸ¢ OPENING SUPPLIER MODAL');
                console.log('='.repeat(60));
                console.log('Supplier ID:', supplierId, 'Type:', typeof supplierId);
                console.log('allSuppliers loaded:', allSuppliers ? allSuppliers.length : 'NULL');
            
            if (!allSuppliers || allSuppliers.length === 0) {
                console.error('âŒ FATAL: allSuppliers is empty or null!');
                alert('âŒ No suppliers loaded. Please refresh the page.');
                return;
            }
            
            // Find supplier - handle both string and number IDs
            const supplier = allSuppliers.find(s => {
                return String(s.id) === String(supplierId);
            });
            
            if (!supplier) {
                console.error('âŒ FATAL: Supplier not found with ID:', supplierId);
                console.log('First 5 supplier IDs:', allSuppliers.slice(0, 5).map(s => `${s.id} (${typeof s.id})}`));
                return;
            }
            
            console.log('âœ… Found supplier:', supplier.name);
            console.log('   Category:', supplier.category);
            console.log('   Location:', supplier.location);

            console.log('\nðŸ“ Populating modal elements...');
            
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');
            const modalBody = document.getElementById('modalBody');
            
            if (!modalTitle || !modalSubtitle || !modalBody) {
                console.error('âŒ FATAL: Modal elements not found!');
                console.error('   modalTitle:', modalTitle);
                console.error('   modalSubtitle:', modalSubtitle);
                console.error('   modalBody:', modalBody);
                return;
            }
            
            console.log('âœ… Modal elements found');
            
            modalTitle.textContent = supplier.name;
            modalSubtitle.textContent = supplier.category;
            console.log('âœ… Set title and subtitle');
            modalBody.innerHTML = `
                <div class="modal-section">
                    <h3>ðŸ“‹ About</h3>
                    <p class="description-text">${supplier.description}</p>
                    ${supplier.walmartVerified ? '<div style="margin-top: 15px;"><span class="walmart-verified">âœ“ Walmart Verified Supplier</span></div>' : ''}
                </div>

                <div class="modal-section">
                    <h3>ðŸ“Š Key Metrics</h3>
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="value">${supplier.aiScore}</div>
                            <div class="label">AI Match Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">â­ ${supplier.rating}</div>
                            <div class="label">Customer Rating</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.yearsInBusiness}</div>
                            <div class="label">Years in Business</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.employees}</div>
                            <div class="label">Employees</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.projectsCompleted.toLocaleString()}</div>
                            <div class="label">Projects Completed</div>
                        </div>
                        <div class="stat-card">
                            <div class="value">${supplier.responseTime}</div>
                            <div class="label">Avg Response Time</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>ðŸ¢ Company Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Location</div>
                            <div class="info-value">ðŸ“ ${supplier.location || (supplier.city + ', ' + supplier.state)}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Company Size</div>
                            <div class="info-value">${supplier.employees} Employees</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">AI Match Score</div>
                            <div class="info-value">${supplier.aiScore}/100</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Years in Business</div>
                            <div class="info-value">${supplier.yearsInBusiness} years</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Contact Phone</div>
                            <div class="info-value">${supplier.phone || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>ðŸ“¦ Products & Services</h3>
                    <div class="product-tags">
                        ${supplier.products.map(p => `<span class="tag" onclick="filterByTag('${p.replace(/'/g, "\\'")}'); closeModal();" title="Click to filter by ${p}" style="cursor: pointer;">${p}</span>`).join('')}
                    </div>
                </div>

                <div class="modal-section">
                    <h3>âœ… Certifications</h3>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        ${supplier.certifications.map(c => `<span class="cert-badge">âœ“ ${c}</span>`).join('')}
                    </div>
                </div>

                <div class="modal-section">
                    <h3>ðŸ“ž Contact Information</h3>
                    <div class="info-grid" style="margin-bottom: 15px;">
                        <div class="info-item">
                            <div class="info-label">Phone</div>
                            <div class="info-value">${supplier.phone}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Email</div>
                            <div class="info-value">${supplier.email}</div>
                        </div>
                    </div>
                    <div class="contact-buttons">
                        <a href="${supplier.website}" target="_blank" class="contact-btn primary">
                            ðŸŒ Visit Website
                        </a>
                        <a href="mailto:${supplier.email}" class="contact-btn secondary">
                            âœ‰ï¸ Send Email
                        </a>
                        <a href="tel:${supplier.phone.replace(/[^0-9]/g, '')}" class="contact-btn secondary">
                            ðŸ“± Call Now
                        </a>
                    </div>
                </div>
            `;

            console.log('\nðŸ–¥ï¸  Displaying modal...');
            
            // SIMPLE DISPLAY - just show what we need to show
            const modal = document.getElementById('supplierModal');
            
            if (!modal) {
                alert('ERROR: Modal element not found. Contact support.');
                console.error('Modal element not found');
                return;
            }
            
            // Force it to show with all the power we have
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.7)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '99999';
            modal.style.visibility = 'visible';
            modal.style.opacity = '1';
            
            // Also add class for CSS
            modal.classList.add('active');
            
            // Prevent scrolling
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            
            console.log('âœ… Modal forced to display with inline styles');
            console.log('âœ¨ MODAL OPENED FOR: ' + supplier.name);
        }

        function closeModal() {
            const modal = document.getElementById('supplierModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('active');
            }
            document.body.style.overflow = '';
            document.body.style.position = '';
            console.log('âœ… Modal closed');
        }

        // Modal close handlers - with safety checks
        const modalCloseBtn = document.getElementById('modalClose');
        const supplierModalElem = document.getElementById('supplierModal');
        
        if (modalCloseBtn) {
            modalCloseBtn.addEventListener('click', function(e) {
                e.preventDefault();
                closeModal();
            });
        }
        
        if (supplierModalElem) {
            supplierModalElem.addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });

        // ADD SUPPLIER FUNCTIONS
        function openAddSupplierModal() {
            document.getElementById('addSupplierModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeAddSupplierModal() {
            document.getElementById('addSupplierModal').style.display = 'none';
            document.body.style.overflow = '';
            document.getElementById('addSupplierForm').reset();
        }

        function submitNewSupplier(event) {
            event.preventDefault();
            
            const newSupplier = {
                id: allSuppliers.length + 1,
                name: document.getElementById('newSupplierName').value,
                category: document.getElementById('newSupplierCategory').value,
                email: document.getElementById('newSupplierEmail').value,
                phone: document.getElementById('newSupplierPhone').value,
                location: document.getElementById('newSupplierLocation').value,
                description: 'Manually added supplier',
                aiScore: Math.floor(Math.random() * 100),
                rating: (Math.random() * 2 + 3).toFixed(1),
                yearsInBusiness: Math.floor(Math.random() * 20) + 1,
                employees: Math.floor(Math.random() * 500) + 10,
                projectsCompleted: Math.floor(Math.random() * 500),
                responseTime: Math.floor(Math.random() * 24) + 'h',
                walmartVerified: false,
                address: document.getElementById('newSupplierLocation').value,
                city: document.getElementById('newSupplierLocation').value.split(',')[0],
                state: document.getElementById('newSupplierLocation').value.split(',')[1] || 'N/A',
                products: [],
                certifications: [],
                website: 'https://example.com'
            };
            
            allSuppliers.push(newSupplier);
            filteredSuppliers = [...allSuppliers];
            
            console.log('âœ… Added new supplier:', newSupplier.name);
            alert(`âœ… Successfully added ${newSupplier.name}!`);
            
            closeAddSupplierModal();
            updateStats();
            renderResults();
        }

        // IMPORT SUPPLIERS FUNCTIONS
        function openImportModal() {
            document.getElementById('importSuppliersModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeImportModal() {
            document.getElementById('importSuppliersModal').style.display = 'none';
            document.body.style.overflow = '';
            document.getElementById('csvFile').value = '';
            document.getElementById('importStatus').style.display = 'none';
        }

        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
                    
                    let imported = 0;
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === '') continue;
                        
                        const cells = lines[i].split(',').map(c => c.trim());
                        const supplier = {
                            id: allSuppliers.length + imported + 1,
                            name: cells[headers.indexOf('name')] || 'Unknown',
                            category: cells[headers.indexOf('category')] || 'Other',
                            email: cells[headers.indexOf('email')] || '',
                            phone: cells[headers.indexOf('phone')] || '',
                            location: cells[headers.indexOf('location')] || '',
                            description: 'Imported supplier',
                            aiScore: Math.floor(Math.random() * 100),
                            rating: (Math.random() * 2 + 3).toFixed(1),
                            yearsInBusiness: Math.floor(Math.random() * 20) + 1,
                            employees: Math.floor(Math.random() * 500) + 10,
                            projectsCompleted: Math.floor(Math.random() * 500),
                            responseTime: Math.floor(Math.random() * 24) + 'h',
                            walmartVerified: false,
                            address: cells[headers.indexOf('location')] || '',
                            city: (cells[headers.indexOf('location')] || '').split(',')[0],
                            state: (cells[headers.indexOf('location')] || '').split(',')[1] || 'N/A',
                            products: [],
                            certifications: [],
                            website: 'https://example.com'
                        };
                        
                        allSuppliers.push(supplier);
                        imported++;
                    }
                    
                    filteredSuppliers = [...allSuppliers];
                    console.log(`âœ… Imported ${imported} suppliers`);
                    
                    const status = document.getElementById('importStatus');
                    const message = document.getElementById('importMessage');
                    message.textContent = `âœ… Successfully imported ${imported} supplier(s)!`;
                    status.style.display = 'block';
                    status.style.background = '#e6ffed';
                    message.style.color = '#00a84f';
                    
                    setTimeout(() => {
                        closeImportModal();
                        updateStats();
                        renderResults();
                    }, 1500);
                    
                } catch (error) {
                    console.error('Import error:', error);
                    const status = document.getElementById('importStatus');
                    const message = document.getElementById('importMessage');
                    message.textContent = 'âŒ Error importing file. Please check CSV format.';
                    status.style.display = 'block';
                    status.style.background = '#ffe6e6';
                    message.style.color = '#c41e3a';
                }
            };
            reader.readAsText(file);
        }

        // Toggle fixture category
        function toggleFixtureCategory(categoryId) {
            const element = document.getElementById(categoryId);
            const icon = document.getElementById('icon-' + categoryId);
            if (element.classList.contains('collapsed')) {
                element.classList.remove('collapsed');
                icon.textContent = 'â–¼';
            } else {
                element.classList.add('collapsed');
                icon.textContent = 'â–¶';
            }
        }

        // Toggle category show more/less
        let categoriesExpanded = false;
        function toggleCategories() {
            const hiddenCategories = document.querySelectorAll('.hidden-category');
            const toggleButton = document.getElementById('categoryToggle');
            const toggleIcon = document.getElementById('categoryToggleIcon');
            
            categoriesExpanded = !categoriesExpanded;
            
            hiddenCategories.forEach(cat => {
                if (categoriesExpanded) {
                    cat.classList.add('show');
                } else {
                    cat.classList.remove('show');
                }
            });
            
            if (categoriesExpanded) {
                const hiddenCount = hiddenCategories.length;
                toggleButton.innerHTML = `<span id="categoryToggleIcon">â–²</span> Show Less`;
            } else {
                const hiddenCount = hiddenCategories.length;
                toggleButton.innerHTML = `<span id="categoryToggleIcon">â–¼</span> Show More (${hiddenCount} more)`;
            }
        }

        // Update stats dashboard
        function updateStats() {
            document.getElementById('totalSuppliersCount').textContent = allSuppliers.length.toLocaleString();
            document.getElementById('categoriesCount').textContent = Object.keys(productCategories).length;
            document.getElementById('productsCount').textContent = Object.values(productCategories).flat().length.toLocaleString();
            document.getElementById('verifiedCount').textContent = allSuppliers.filter(s => s.walmartVerified).length.toLocaleString();
        }

        // ==========================================
        // USER AUTHENTICATION & FAVORITES SYSTEM
        // ==========================================
        
        // NOTE: currentUser and userData already declared above (lines 1835-1836)
        // DO NOT REDECLARE THEM HERE!

        async function checkUserSession() {
            try {
                // Try to initialize SharePoint
                const spStatusElem = document.getElementById('spStatus');
                try {
                    useSharePoint = await spService.init();
                    if (useSharePoint) {
                        console.log('âœ… SharePoint connected! Using cloud storage.');
                        if (spStatusElem) spStatusElem.innerHTML = 'â˜ï¸ Cloud Mode';
                    } else {
                        console.log('âš ï¸ SharePoint unavailable. Using localStorage fallback.');
                        if (spStatusElem) spStatusElem.innerHTML = 'ðŸ’¾ Local Mode';
                    }
                } catch (error) {
                    console.warn('SharePoint init error:', error);
                    useSharePoint = false;
                    if (spStatusElem) spStatusElem.innerHTML = 'ðŸ’¾ Local Mode';
                }

                // Get current user email from login or auto-login
                let userEmail = localStorage.getItem('user_email') || localStorage.getItem('currentUser');
                
                // If using SharePoint and no localStorage user, try to get from SharePoint
                if (!userEmail && useSharePoint && spService.currentUserEmail) {
                    userEmail = spService.currentUserEmail;
                }
                
                // If still no user, check if logged in via login form
                if (!userEmail) {
                    // Redirect to login if not authenticated
                    const sessionId = localStorage.getItem('session_id');
                    if (!sessionId) {
                        console.log('âš ï¸ No user session found, redirecting to login');
                        window.location.href = '/login.html';
                        return false;
                    }
                    // Create a default for testing
                    userEmail = 'supplier_user@walmart.com';
                }
                
                localStorage.setItem('currentUser', userEmail);

                currentUser = userEmail;
                console.log('ðŸ‘¤ Current user:', currentUser);
                
                // Load user data from storage (SharePoint or localStorage)
                userData = await storage.getUser(userEmail);

                // If user doesn't exist, auto-create one
                if (!userData) {
                    userData = {
                        name: 'Supplier User',
                        email: userEmail,
                        department: 'Procurement',
                        favorites: [],
                        notes: {},
                        inbox: []
                    };
                    await storage.saveUser(userEmail, userData);
                    console.log('âœ… Auto-created user:', userEmail);
                }

                // Update UI with user name
                const userName = document.getElementById('userName');
                if (userName) {
                    userName.textContent = `ðŸ‘¤ ${userData.name.split(' ')[0]}`;
                    console.log('âœ… Updated UI with user name');
                }
                
                // Safe function calls - only if they exist
                if (typeof updateFavoriteCount === 'function') {
                    try {
                        await updateFavoriteCount();
                    } catch (e) {
                        console.warn('updateFavoriteCount error:', e);
                    }
                }
                if (typeof updateFavoriteButtons === 'function') {
                    try {
                        await updateFavoriteButtons();
                    } catch (e) {
                        console.warn('updateFavoriteButtons error:', e);
                    }
                }
                if (typeof updateNoteButtons === 'function') {
                    try {
                        await updateNoteButtons();
                    } catch (e) {
                        console.warn('updateNoteButtons error:', e);
                    }
                }

                console.log('âœ… Session check completed successfully');
                return true;
            } catch (error) {
                console.error('âŒ checkUserSession error:', error);
                return false;
            }
        }

        function toggleUserDropdown(event) {
            event.stopPropagation();
            
            // Check if dropdown already exists
            let overlay = document.getElementById('userDropdownOverlay');
            let dropdown = document.querySelector('.user-dropdown');
            
            if (overlay && dropdown) {
                // Close it
                overlay.remove();
                dropdown.remove();
            } else {
                // Get button position
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                
                // Create overlay
                const overlayDiv = document.createElement('div');
                overlayDiv.id = 'userDropdownOverlay';
                overlayDiv.className = 'user-dropdown-overlay active';
                overlayDiv.onclick = function() {
                    overlayDiv.remove();
                    const dd = document.querySelector('.user-dropdown');
                    if (dd) dd.remove();
                };
                
                // Create dropdown positioned directly under button
                const dropdownDiv = document.createElement('div');
                dropdownDiv.className = 'user-dropdown';
                dropdownDiv.style.top = (rect.bottom + 10) + 'px';
                dropdownDiv.style.right = (window.innerWidth - rect.right) + 'px';
                dropdownDiv.innerHTML = `
                    <div class="dropdown-item" onclick="window.location.href='inbox.html'">ðŸ“§ Inbox</div>
                    <div class="dropdown-item" onclick="window.location.href='favorites.html'">â¤ï¸ My Favorites (<span id="favCountDrop">${userData?.favorites?.length || 0}</span>)</div>
                    <div class="dropdown-item" onclick="window.location.href='notes.html'">ðŸ“ My Notes</div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" onclick="logout()">ðŸšª Logout</div>
                `;
                
                document.body.appendChild(overlayDiv);
                document.body.appendChild(dropdownDiv);
            }
        }

        function logout() {
            console.log('ðŸšª Logging out user...');
            
            // Clear all user data
            localStorage.removeItem('currentUser');
            localStorage.removeItem('supplierPortalUser');
            localStorage.removeItem('session_id');
            localStorage.removeItem('user_id');
            localStorage.removeItem('user_email');
            localStorage.removeItem('user_name');
            
            console.log('âœ… Session cleared');
            
            // Redirect to login page
            window.location.href = '/login.html';
        }

        function toggleFavorite(supplierId) {
            console.log('ðŸ–¤ toggleFavorite called for ID:', supplierId, 'Type:', typeof supplierId);
            
            if (!userData) {
                console.error('âŒ No user data! userData is null/undefined');
                alert('Please login first!');
                return;
            }
            
            console.log('ðŸ“Š Current userData:', userData);

            if (!userData.favorites) {
                userData.favorites = [];
                console.log('ðŸ“ Created empty favorites array');
            }

            // Convert to string for consistent comparison (API returns SUP-00001)
            const suppId = String(supplierId);
            const favoritesAsStrings = userData.favorites.map(f => String(f));
            const index = favoritesAsStrings.indexOf(suppId);
            
            if (index > -1) {
                // Remove favorite
                userData.favorites.splice(index, 1);
                console.log('âŒ Removed from favorites:', supplierId);
                console.log('âœ… Favorites now:', userData.favorites);
            } else {
                // Add favorite
                userData.favorites.push(supplierId);
                console.log('âœ… Added to favorites:', supplierId);
                console.log('âœ… Favorites now:', userData.favorites);
            }

            // Save to localStorage
            try {
                localStorage.setItem('supplierPortalUser', JSON.stringify(userData));
                console.log('ðŸ’¾ Saved userData to localStorage:', userData);
            } catch (e) {
                console.error('âŒ Failed to save to localStorage:', e);
                return;
            }
            
            updateFavoriteButtons();
            updateFavoriteCount();
            console.log('âœ… Heart button updated');
        }

        function updateFavoriteButtons() {
            if (!userData || !userData.favorites) return;

            console.log('ðŸŽ¨ Updating favorite buttons. Favorites:', userData.favorites);
            
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                // Extract ID from button ID (e.g., 'fav-SUP-00001' -> 'SUP-00001')
                const supplierId = btn.id.replace('fav-', '');
                
                // Convert favorites to strings for comparison
                const favoritesAsStrings = userData.favorites.map(f => String(f));
                const isFavorited = favoritesAsStrings.includes(String(supplierId));
                
                console.log(`  Button ID: ${supplierId}, IsFavorited: ${isFavorited}`);
                
                if (isFavorited) {
                    btn.classList.add('favorited');
                    btn.style.color = '#ff1744';
                    btn.style.textShadow = '0 0 5px rgba(255, 23, 68, 0.5)';
                    console.log(`  âœ… Added favorited class to ${supplierId}`);
                } else {
                    btn.classList.remove('favorited');
                    btn.style.color = '';
                    btn.style.textShadow = '';
                    console.log(`  âŒ Removed favorited class from ${supplierId}`);
                }
            });
        }

        function updateFavoriteCount() {
            if (!userData || !userData.favorites) return;
            const favCountElem = document.getElementById('favCount');
            if (favCountElem) favCountElem.textContent = userData.favorites.length;
            const favCountDrop = document.getElementById('favCountDrop');
            if (favCountDrop) favCountDrop.textContent = userData.favorites.length;
        }

        function showMyFavorites() {
            if (!userData || !userData.favorites || userData.favorites.length === 0) {
                showNotification('â¤ï¸ No favorites yet! Click the heart icon on suppliers to save them.');
                return;
            }

            // Filter to show only favorites
            filteredSuppliers = allSuppliers.filter(s => userData.favorites.includes(s.id));
            currentPage = 1;
            renderResults();

            showNotification(`â¤ï¸ Showing ${filteredSuppliers.length} favorite suppliers`);
            document.getElementById('userDropdown').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function openNoteModal(supplierId) {
            console.log('ðŸ“ openNoteModal called for ID:', supplierId, 'Type:', typeof supplierId);
            
            // Find supplier - handle both string and number IDs
            const supplier = allSuppliers.find(s => String(s.id) === String(supplierId));
            
            if (!supplier) {
                console.error('âŒ Supplier not found for note with ID:', supplierId);
                return;
            }
            
            console.log('âœ… Found supplier for note:', supplier.name);

            const currentNote = (userData.notes && userData.notes[supplierId]) || '';

            const modalHTML = `
                <div class="note-modal" id="noteModal">
                    <div class="note-modal-content">
                        <div class="note-modal-header">
                            <h2 style="font-family: var(--heading-font); font-size: 1.5rem; letter-spacing: 1px;">ðŸ“ NOTES: ${supplier.name}</h2>
                            <button onclick="closeNoteModal()" class="modal-close">âœ•</button>
                        </div>
                        <div class="note-modal-body">
                            <textarea id="noteTextarea" placeholder="Add your notes about this supplier..." style="width: 100%; height: 200px; padding: 15px; font-family: var(--body-font); font-size: 1rem; border: 2px solid #ddd; resize: vertical;">${currentNote}</textarea>
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button onclick="saveNote('${supplierId}')" class="btn btn-primary" style="flex: 1; padding: 12px;">ðŸ’¾ SAVE NOTE</button>
                                <button onclick="deleteNote('${supplierId}')" class="btn btn-secondary" style="padding: 12px;">ðŸ—‘ï¸ DELETE</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function closeNoteModal() {
            const modal = document.getElementById('noteModal');
            if (modal) modal.remove();
        }

        function saveNote(supplierId) {
            console.log('ðŸ’¾ saveNote called for ID:', supplierId, 'Type:', typeof supplierId);
            
            if (!userData) {
                console.error('âŒ userData is null/undefined');
                alert('Please login first!');
                return;
            }
            
            const noteTextarea = document.getElementById('noteTextarea');
            if (!noteTextarea) {
                console.error('âŒ Textarea not found!');
                return;
            }
            
            const noteText = noteTextarea.value.trim();
            console.log('ðŸ“ Note text:', noteText);
            
            if (!userData.notes) {
                userData.notes = {};
                console.log('ðŸ“ Created empty notes object');
            }

            // Convert supplierId to string for consistency
            const suppIdStr = String(supplierId);
            
            if (noteText) {
                userData.notes[suppIdStr] = noteText;
                console.log('âœ… Saved note for supplier:', suppIdStr);
                console.log('ðŸ“Š Notes now:', userData.notes);
            } else {
                delete userData.notes[suppIdStr];
                console.log('ðŸ—‘ï¸ Cleared note for supplier:', suppIdStr);
                console.log('ðŸ“Š Notes now:', userData.notes);
            }

            // Save to localStorage
            try {
                localStorage.setItem('supplierPortalUser', JSON.stringify(userData));
                console.log('ðŸ’¾ Saved userData to localStorage');
            } catch (e) {
                console.error('âŒ Failed to save to localStorage:', e);
                alert('âŒ Failed to save note!');
                return;
            }
            
            updateNoteButtons();
            closeNoteModal();
            
            if (noteText) {
                console.log('âœ… Alert: Note saved successfully!');
                alert('âœ… Note saved successfully!');
            } else {
                console.log('ðŸ—‘ï¸ Alert: Note cleared');
                alert('ðŸ—‘ï¸ Note cleared');
            }
        }

        function deleteNote(supplierId) {
            console.log('ðŸ—‘ï¸ deleteNote called for ID:', supplierId, 'Type:', typeof supplierId);
            
            if (!confirm('Are you sure you want to delete this note?')) {
                console.log('User cancelled delete');
                return;
            }
            
            if (!userData) {
                console.error('âŒ userData is null');
                return;
            }
            
            // Convert to string for consistency
            const suppIdStr = String(supplierId);
            
            if (userData.notes && userData.notes[suppIdStr]) {
                delete userData.notes[suppIdStr];
                console.log('âœ… Deleted note for:', suppIdStr);
                console.log('ðŸ“Š Notes now:', userData.notes);
                
                try {
                    localStorage.setItem('supplierPortalUser', JSON.stringify(userData));
                    console.log('ðŸ’¾ Saved to localStorage');
                } catch (e) {
                    console.error('âŒ Failed to save:', e);
                    alert('âŒ Failed to delete note!');
                }
                
                updateNoteButtons();
                alert('ðŸ—‘ï¸ Note deleted');
            } else {
                console.log('No note found for ID:', suppIdStr);
            }

            closeNoteModal();
        }

        function updateNoteButtons() {
            if (!userData || !userData.notes) return;

            document.querySelectorAll('.note-btn').forEach(btn => {
                const supplierId = parseInt(btn.getAttribute('onclick').match(/\d+/)[0]);
                if (userData.notes[supplierId]) {
                    btn.classList.add('has-note');
                } else {
                    btn.classList.remove('has-note');
                }
            });
        }

        function showMyNotes() {
            if (!userData || !userData.notes || Object.keys(userData.notes).length === 0) {
                showNotification('ðŸ“ No notes yet! Click the note icon on suppliers to add notes.');
                return;
            }

            const supplierIds = Object.keys(userData.notes).map(id => parseInt(id));
            filteredSuppliers = allSuppliers.filter(s => supplierIds.includes(s.id));
            currentPage = 1;
            renderResults();

            showNotification(`ðŸ“ Showing ${filteredSuppliers.length} suppliers with notes`);
            document.getElementById('userDropdown').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Add CSS for note modal
        const noteModalStyle = document.createElement('style');
        noteModalStyle.textContent = `
            .note-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            .note-modal-content {
                background: white;
                width: 100%;
                max-width: 600px;
                border: 4px solid var(--walmart-blue);
                box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.3);
            }
            .note-modal-header {
                background: var(--walmart-blue);
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 4px solid var(--walmart-yellow);
            }
            .note-modal-body {
                padding: 30px;
            }
        `;
        document.head.appendChild(noteModalStyle);

        // Initialize - Check user session first (async now!)
        (async function() {
            const sessionValid = await checkUserSession();
            if (sessionValid) {
                initializeFilters();
                updateStats();
                renderResults();
            }
        })();
    </script>
    <!-- CHATBOT WIDGET STYLES -->
    <style>
        /* Chatbot Styles */
        .chatbot-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'Inter', sans-serif;
            z-index: 9999;
        }

        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--walmart-blue);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 12px rgba(0, 113, 206, 0.3);
            transition: all 0.3s ease;
        }

        .chatbot-toggle:hover {
            background: var(--walmart-dark-blue);
            box-shadow: 0 6px 16px rgba(0, 113, 206, 0.4);
            transform: scale(1.1);
        }

        .chatbot-toggle.active {
            display: none;
        }

        .chatbot-container {
            display: none;
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 400px;
            max-width: 90vw;
            height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        .chatbot-container.active {
            display: flex;
            flex-direction: column;
        }

        .chatbot-header {
            background: linear-gradient(135deg, var(--walmart-blue) 0%, var(--walmart-dark-blue) 100%);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
            padding: 0;
            width: 24px;
            height: 24px;
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #f5f5f5;
        }

        .chat-message {
            display: flex;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .chat-bubble {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-bubble.user {
            background: var(--walmart-blue);
            color: white;
            border-radius: 12px 4px 12px 12px;
        }

        .chat-bubble.bot {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px 12px 12px 12px;
        }

        .chat-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .suggestion-btn {
            background: white;
            border: 1px solid var(--walmart-blue);
            color: var(--walmart-blue);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .suggestion-btn:hover {
            background: var(--walmart-blue);
            color: white;
        }

        .chatbot-input-area {
            display: flex;
            gap: 8px;
            padding: 12px;
            border-top: 1px solid #ddd;
            background: white;
        }

        .chatbot-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 16px;
            font-size: 14px;
            outline: none;
        }

        .chatbot-input:focus {
            border-color: var(--walmart-blue);
        }

        .chatbot-send {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--walmart-blue);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chatbot-send:hover {
            background: var(--walmart-dark-blue);
            transform: scale(1.05);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
    </style>

    <!-- CHATBOT WIDGET HTML -->
    <div class="chatbot-widget">
        <button class="chatbot-toggle" id="chatbot-toggle" title="Open assistant">
            ðŸ’¬
        </button>
        <div class="chatbot-container" id="chatbot-container">
            <div class="chatbot-header">
                <h3>Supplier Assistant</h3>
                <button class="chatbot-close" id="chatbot-close">&times;</button>
            </div>
            <div class="chatbot-messages" id="chatbot-messages"></div>
            <div class="chatbot-input-area">
                <input 
                    type="text" 
                    class="chatbot-input" 
                    id="chatbot-input" 
                    placeholder="Ask about suppliers..."
                    autocomplete="off"
                >
                <button class="chatbot-send" id="chatbot-send">â†’</button>
            </div>
        </div>
    </div>

    <script>
        // Chatbot functionality
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');

        chatbotToggle.addEventListener('click', () => {
            chatbotContainer.classList.add('active');
            chatbotToggle.classList.add('active');
            chatbotInput.focus();
        });

        chatbotClose.addEventListener('click', () => {
            chatbotContainer.classList.remove('active');
            chatbotToggle.classList.remove('active');
        });

        async function sendChatMessage() {
            const message = chatbotInput.value.trim();
            if (!message) return;

            addChatMessage(message, 'user');
            chatbotInput.value = '';
            showTypingIndicator();

            try {
                const response = await fetch(`${API_BASE}/api/chatbot/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, userId: currentUser })
                });

                const data = await response.json();
                removeTypingIndicator();

                if (data.success) {
                    addChatMessage(data.message, 'bot', data.suggestions);
                    
                    // ðŸ”¥ NEW: Handle chatbot actions (like filtering)
                    if (data.action) {
                        console.log('ðŸŽ¬ Chatbot action:', data.action);
                        handleChatbotAction(data.action);
                    }
                } else {
                    addChatMessage(data.message || 'I encountered an error. Please try again.', 'bot');
                }
            } catch (error) {
                console.error('Chat error:', error);
                removeTypingIndicator();
                addChatMessage('Sorry, I encountered an error. Please try again.', 'bot');
            }
        }
        
        // ðŸ”¥ NEW: Handle actions from chatbot (filtering, searching, etc.)
        function handleChatbotAction(action) {
            if (action.type === 'filter') {
                if (action.filterType === 'category') {
                    // Filter by category
                    console.log(`ðŸ” Filtering by category: ${action.filterValue}`);
                    
                    // Filter suppliers by category
                    filteredSuppliers = allSuppliers.filter(s => 
                        s.category.toLowerCase() === action.filterValue.toLowerCase()
                    );
                    
                    currentPage = 1;
                    
                    // Update the view
                    if (typeof renderResults === 'function') {
                        renderResults();
                    } else {
                        console.log(`ðŸ“Š Found ${filteredSuppliers.length} ${action.filterValue} suppliers`);
                    }
                    
                    // Show notification
                    showChatNotification(`âœ… Showing ${filteredSuppliers.length} ${action.filterValue} suppliers`);
                    
                    // Scroll dashboard into view
                    const mainContent = document.querySelector('.main-content');
                    if (mainContent) {
                        setTimeout(() => mainContent.scrollIntoView({ behavior: 'smooth' }), 300);
                    }
                }
            }
        }
        
        // Show notification from chatbot
        function showChatNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 100px;
                right: 20px;
                background: var(--walmart-blue);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 9998;
                font-weight: 600;
                animation: slideInBottom 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutBottom 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function addChatMessage(text, sender, suggestions = null) {
            const messageEl = document.createElement('div');
            messageEl.className = `chat-message ${sender}`;
            
            let html = `<div class="chat-bubble ${sender}">${text.replace(/\n/g, '<br>')}</div>`;
            
            if (suggestions && sender === 'bot') {
                html += '<div class="chat-suggestions">';
                suggestions.slice(0, 3).forEach((suggestion, idx) => {
                    const suggestionId = `suggestion-${Date.now()}-${idx}`;
                    html += `<button class="suggestion-btn" id="${suggestionId}" data-suggestion="${suggestion.replace(/"/g, '&quot;')}">${suggestion}</button>`;
                });
                html += '</div>';
            }
            
            messageEl.innerHTML = html;
            chatbotMessages.appendChild(messageEl);
            
            // Add click handlers to suggestion buttons
            if (suggestions && sender === 'bot') {
                messageEl.querySelectorAll('.suggestion-btn').forEach((btn, idx) => {
                    btn.addEventListener('click', async (e) => {
                        const suggestion = suggestions[idx];
                        console.log('ðŸ“¤ Suggestion clicked:', suggestion);
                        
                        // Auto-send the suggestion as a new message
                        chatbotInput.value = suggestion;
                        await sendChatMessage();
                    });
                });
            }
            
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const messageEl = document.createElement('div');
            messageEl.className = 'chat-message bot';
            messageEl.id = 'typing-indicator';
            messageEl.innerHTML = `<div class="chat-bubble bot"><div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>`;
            chatbotMessages.appendChild(messageEl);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        chatbotSend.addEventListener('click', sendChatMessage);
        chatbotInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Auto-login on page load
        // LOAD DATA - CONNECT TO SERVER
        window.addEventListener('load', () => {
            console.log('ðŸ”„ PAGE LOAD EVENT STARTING...');
            
            // TRY TO LOAD FROM SERVER FIRST
            console.log('ðŸŒ Fetching suppliers from server API...');
            fetch('/api/suppliers')
                .then(response => {
                    console.log('ðŸ“¥ Server response:', response.status, response.statusText);
                    if (!response.ok) throw new Error('Server error: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('âœ… Server data received:', data.count, 'suppliers');
                    if (data.success && data.data && Array.isArray(data.data)) {
                        allSuppliers = data.data;
                        filteredSuppliers = [...allSuppliers];
                        console.log(`âœ… Loaded ${allSuppliers.length} suppliers from SERVER`);
                        
                        // Update status
                        const statusElem = document.getElementById('spStatus');
                        if (statusElem) {
                            statusElem.innerHTML = 'â˜ï¸ Server (Live Data)';
                            statusElem.style.color = '#4ade80';
                        }
                    } else {
                        throw new Error('Invalid data format from server');
                    }
                    
                    // Render UI
                    console.log('ðŸŽ¨ Rendering UI...');
                    updateStats();
                    renderResults();
                    initializeFilters();
                    console.log('âœ… DASHBOARD READY WITH SERVER DATA!');
                })
                .catch(err => {
                    // FALLBACK: If server fails, use local data
                    console.warn('âš ï¸ Server load failed:', err.message);
                    console.log('ðŸ“‚ Loading local seeded data as fallback...');
                    
                    allSuppliers = generateSuppliers();
                    filteredSuppliers = [...allSuppliers];
                    console.log(`âœ… Loaded ${allSuppliers.length} suppliers from LOCAL`);
                    
                    // Update status
                    const statusElem = document.getElementById('spStatus');
                    if (statusElem) {
                        statusElem.innerHTML = 'ðŸ’¾ Local Data (Server Unavailable)';
                        statusElem.style.color = '#f59e0b';
                    }
                    
                    // Render UI
                    console.log('ðŸŽ¨ Rendering UI...');
                    updateStats();
                    renderResults();
                    initializeFilters();
                    console.log('âœ… DASHBOARD READY WITH LOCAL DATA!');
                });
        });
    </script>



    <!-- ADD SUPPLIER MODAL -->
    <div id="addSupplierModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 2000; overflow-y: auto;">
        <div class="modal-content" style="background: white; margin: 30px auto; padding: 30px; border-radius: 10px; max-width: 600px; box-shadow: 0 5px 30px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: var(--walmart-blue);">âž• Add New Supplier</h2>
                <button onclick="closeAddSupplierModal()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999;">&times;</button>
            </div>
            <form id="addSupplierForm" onsubmit="submitNewSupplier(event)" style="display: flex; flex-direction: column; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Company Name *</label>
                    <input type="text" id="newSupplierName" required placeholder="Enter company name" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Category *</label>
                    <select id="newSupplierCategory" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">Select a category</option>
                        <option value="Concrete & Cement">Concrete & Cement</option>
                        <option value="Steel & Metal">Steel & Metal</option>
                        <option value="Lumber & Wood">Lumber & Wood</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="HVAC">HVAC</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Contact Email *</label>
                    <input type="email" id="newSupplierEmail" required placeholder="email@company.com" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Phone</label>
                    <input type="tel" id="newSupplierPhone" placeholder="(123) 456-7890" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Location</label>
                    <input type="text" id="newSupplierLocation" placeholder="City, State" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1; padding: 12px; background: var(--walmart-blue); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">âœ… Add Supplier</button>
                    <button type="button" onclick="closeAddSupplierModal()" style="flex: 1; padding: 12px; background: #ddd; color: #333; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- IMPORT SUPPLIERS MODAL -->
    <div id="importSuppliersModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 2000; overflow-y: auto;">
        <div class="modal-content" style="background: white; margin: 30px auto; padding: 30px; border-radius: 10px; max-width: 600px; box-shadow: 0 5px 30px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0; color: var(--walmart-blue);">ðŸ“¥ Import Suppliers</h2>
                <button onclick="closeImportModal()" style="background: none; border: none; font-size: 2rem; cursor: pointer; color: #999;">&times;</button>
            </div>
            <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; border: 2px dashed #0071ce; text-align: center; cursor: pointer;" id="dropZone" onclick="document.getElementById('csvFile').click()">
                <div style="font-size: 2rem; margin-bottom: 10px;">ðŸ“„</div>
                <p style="margin: 0; font-weight: 600; color: var(--walmart-blue);">Drop CSV file here or click to browse</p>
                <p style="margin: 5px 0 0 0; color: #999; font-size: 0.9rem;">Supported format: CSV with columns (Name, Category, Email, Phone, Location)</p>
                <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleImportFile(event)">
            </div>
            <div id="importStatus" style="margin-top: 20px; padding: 15px; background: #f0f7ff; border-radius: 5px; display: none;">
                <p id="importMessage" style="margin: 0;"></p>
            </div>
        </div>
    </div>

    <!-- STYLE FOR MODALS -->
    <style>
        .modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
    </style>

</body>
</html>
