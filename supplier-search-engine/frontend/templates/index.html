{% extends 'base.html' %}

{% block title %}Dashboard - Supplier Search Engine{% endblock %}

{% block extra_styles %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .stat-value {
        font-size: 36px;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stat-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    .chart-container {
        margin: 40px 0;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
    }
    
    .category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .category-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .category-name {
        font-weight: 600;
        color: #333;
    }
    
    .category-count {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
        margin-top: 8px;
    }
</style>
{% endblock %}

{% block content %}
<h1>üìä Dashboard</h1>

<div id="loading" class="loading">Loading dashboard data...</div>
<div id="content" style="display: none;">
    <div class="stats-grid" id="statsGrid"></div>
    
    <h2>Category Distribution</h2>
    <div class="category-grid" id="categoryGrid"></div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    async function loadDashboard() {
        try {
            const response = await fetch(API_BASE + '/api/stats');
            const stats = await response.json();
            
            if (!stats) {
                throw new Error('No data received');
            }
            
            // Build stats grid
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Suppliers</div>
                    <div class="stat-value">${stats.total_suppliers.toLocaleString()}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Walmart Verified</div>
                    <div class="stat-value">${stats.walmart_verified.toLocaleString()}</div>
                    <div style="font-size: 12px; margin-top: 5px;">${stats.verified_percentage}% of total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Rating</div>
                    <div class="stat-value">${stats.average_rating}</div>
                    <div style="font-size: 12px; margin-top: 5px;">‚≠ê out of 5</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average AI Score</div>
                    <div class="stat-value">${stats.average_ai_score}</div>
                    <div style="font-size: 12px; margin-top: 5px;">out of 100</div>
                </div>
            `;
            
            // Build categories
            const categoryGrid = document.getElementById('categoryGrid');
            const categoryItems = Object.entries(stats.categories)
                .sort((a, b) => b[1] - a[1])
                .map(([name, count]) => `
                    <div class="category-item">
                        <div class="category-name">${name}</div>
                        <div class="category-count">${count}</div>
                        <div style="font-size: 12px; color: #999; margin-top: 5px;">
                            ${(count / stats.total_suppliers * 100).toFixed(1)}%
                        </div>
                    </div>
                `).join('');
            categoryGrid.innerHTML = categoryItems;
            
            // Show content
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        } catch (error) {
            console.error('Error loading dashboard:', error);
            document.getElementById('loading').innerHTML = 
                `<div class="error">Error loading dashboard data. Make sure the backend API is running at http://127.0.0.1:8000</div>`;
        }
    }
    
    loadDashboard();
</script>
{% endblock %}
